<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PPH Flow Staffing - Process Assistant Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800&family=Barlow+Condensed:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --amazon-orange: #FF9900;
      --amazon-orange-dark: #E88B00;
      --amazon-blue: #232F3E;
      --amazon-blue-light: #37475A;
      --amazon-teal: #00A8A8;
      --bg-dark: #0D1117;
      --bg-card: #161B22;
      --bg-card-hover: #1C2128;
      --text-primary: #F0F6FC;
      --text-secondary: #8B949E;
      --text-muted: #6E7681;
      --border-color: #30363D;
      --success: #3FB950;
      --warning: #D29922;
      --danger: #F85149;
      --input-bg: #0D1117;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Barlow', sans-serif;
      background: var(--bg-dark);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--amazon-blue) 0%, var(--amazon-blue-light) 100%);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid var(--amazon-orange);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: var(--amazon-orange);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--amazon-blue);
    }

    .logo-text {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .logo-text span {
      color: var(--amazon-orange);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .header-time {
      text-align: right;
    }

    .current-time {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2rem;
      font-weight: 600;
      color: var(--amazon-orange);
    }

    .current-date {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Main Container */
    .container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    /* Belt Run Time Section */
    .belt-section {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-color);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--amazon-orange);
    }

    .section-title {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-title::before {
      content: '';
      width: 4px;
      height: 24px;
      background: var(--amazon-orange);
      border-radius: 2px;
    }

    .belt-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .time-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .time-input-group label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .time-input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.2s;
    }

    .time-input:focus {
      outline: none;
      border-color: var(--amazon-orange);
      box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.2);
    }

    .run-time-display {
      background: linear-gradient(135deg, var(--amazon-blue) 0%, var(--amazon-blue-light) 100%);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      border: 2px solid var(--amazon-orange);
    }

    .run-time-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }

    .run-time-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    .run-time-subtext {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Break Adjustments */
    .breaks-section {
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }

    .breaks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    .break-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: var(--input-bg);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    .break-checkbox {
      width: 20px;
      height: 20px;
      accent-color: var(--amazon-orange);
      cursor: pointer;
    }

    .break-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .break-time {
      margin-left: auto;
      font-weight: 600;
      color: var(--amazon-orange);
    }

    /* Volume Entry Section */
    .volume-section {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
    }

    .total-volume-display {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    .total-volume-input-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .total-volume-input {
      background: var(--input-bg);
      border: 3px solid var(--amazon-orange);
      border-radius: 12px;
      padding: 1rem;
      color: var(--amazon-orange);
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      text-align: center;
      width: 250px;
      transition: all 0.2s;
    }

    .total-volume-input:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(255, 153, 0, 0.3);
    }

    .total-volume-input::placeholder {
      color: var(--text-muted);
      font-size: 2rem;
    }

    .total-volume-label {
      font-size: 1rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 0.5rem;
    }

    .cluster-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
    }

    .cluster-input {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .cluster-label {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--amazon-teal);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .cluster-badge {
      width: 32px;
      height: 32px;
      background: var(--amazon-teal);
      color: var(--bg-dark);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .volume-input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1.25rem;
      font-weight: 600;
      text-align: right;
      width: 100%;
      transition: all 0.2s;
    }

    .volume-input:focus {
      outline: none;
      border-color: var(--amazon-teal);
      box-shadow: 0 0 0 3px rgba(0, 168, 168, 0.2);
    }

    .volume-input::placeholder {
      color: var(--text-muted);
    }

    /* Progress Tracking Section */
    .progress-section {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .progress-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid var(--border-color);
    }

    .progress-input-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .progress-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .progress-input-group label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .progress-input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1.25rem;
      font-weight: 600;
      text-align: center;
      width: 100%;
    }

    .progress-input:focus {
      outline: none;
      border-color: var(--amazon-orange);
      box-shadow: 0 0 0 3px rgba(255, 153, 0, 0.2);
    }

    /* Induct Complete Button */
    .btn-induct-complete {
      width: 100%;
      margin-top: 1rem;
      background: linear-gradient(135deg, #059669 0%, #10B981 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.85rem 1.5rem;
      font-family: 'Barlow', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .btn-induct-complete:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .btn-induct-complete.completed {
      background: linear-gradient(135deg, #6B7280 0%, #9CA3AF 100%);
      cursor: not-allowed;
    }

    /* Final Stow Panel */
    .final-stow-panel {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.15) 100%);
      border: 3px solid #10B981;
      border-radius: 16px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }

    .final-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid #10B981;
      flex-wrap: wrap;
    }

    .final-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: #10B981;
      text-transform: uppercase;
    }

    .final-flag {
      font-size: 1.5rem;
    }

    .final-time {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.1rem;
      color: var(--text-secondary);
    }

    .final-stow-list {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .final-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }

    .final-row .final-icon {
      font-size: 1rem;
      width: 24px;
      text-align: center;
    }

    .final-row .final-label {
      flex: 1;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .final-row .final-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .final-row .final-value.green { color: #10B981; }
    .final-row .final-value.orange { color: var(--amazon-orange); }
    .final-row .final-value.red { color: #F85149; }
    .final-row .final-value.purple { color: #A78BFA; }

    .final-row.highlight-row {
      background: rgba(255, 153, 0, 0.2);
      border: 2px solid var(--amazon-orange);
      padding: 0.75rem;
    }

    .final-row.highlight-row .final-value.big {
      font-size: 1.75rem;
      color: var(--amazon-orange);
    }

    .final-row .final-unit {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .btn-copy-final {
      background: linear-gradient(135deg, var(--purple) 0%, #7C3AED 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-family: 'Barlow', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .btn-copy-final:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .btn-undo-induct {
      background: linear-gradient(135deg, #6B7280 0%, #4B5563 100%);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.4rem 0.75rem;
      font-family: 'Barlow', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      margin-left: auto;
    }

    .btn-undo-induct:hover {
      background: linear-gradient(135deg, #4B5563 0%, #374151 100%);
    }

    .final-copy-confirm {
      margin-left: 1rem;
      color: var(--success);
      font-weight: 600;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .final-copy-confirm.show {
      opacity: 1;
    }

    @media (max-width: 480px) {
      .final-stow-panel {
        padding: 1rem;
      }
      .final-title {
        font-size: 1rem;
      }
      .final-row .final-value {
        font-size: 1.1rem;
      }
      .final-row.highlight-row .final-value.big {
        font-size: 1.5rem;
      }
      .btn-copy-final {
        width: 100%;
        justify-content: center;
      }
    }

    /* Staffing Results */
    .staffing-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
    }

    .staffing-card {
      background: var(--bg-card);
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .staffing-card-header {
      background: linear-gradient(135deg, var(--amazon-blue) 0%, var(--amazon-blue-light) 100%);
      padding: 1rem 1.5rem;
      border-bottom: 3px solid var(--amazon-orange);
    }

    .staffing-card-title {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .staffing-card-body {
      padding: 1rem;
    }

    .staffing-table {
      width: 100%;
      border-collapse: collapse;
    }

    .staffing-table th,
    .staffing-table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .staffing-table th {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-muted);
      font-weight: 600;
    }

    .staffing-table td {
      font-weight: 500;
    }

    .staffing-table tr:last-child td {
      border-bottom: none;
    }

    .staffing-table .role-name {
      color: var(--text-primary);
    }

    .staffing-table .staff-count {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--amazon-orange);
      text-align: center;
    }

    .staffing-table .actual-input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 6px;
      padding: 0.5rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      width: 60px;
      text-align: center;
    }

    .staffing-table .actual-input:focus {
      outline: none;
      border-color: var(--amazon-orange);
    }

    .staffing-table .pph-value {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .staffing-total {
      background: var(--amazon-blue);
      padding: 1rem 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .staffing-total-label {
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .staffing-total-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    /* PPH Reference Section */
    .pph-reference {
      margin-top: 1.5rem;
    }

    .pph-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 0.75rem;
    }

    .pph-item {
      background: var(--input-bg);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .pph-role {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .pph-value-display {
      font-weight: 700;
      color: var(--amazon-teal);
    }

    /* Buttons */
    .btn {
      background: var(--amazon-orange);
      color: var(--amazon-blue);
      border: none;
      border-radius: 8px;
      padding: 0.75rem 1.5rem;
      font-family: 'Barlow', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn:hover {
      background: var(--amazon-orange-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 153, 0, 0.3);
    }

    .btn-secondary {
      background: var(--amazon-blue-light);
      color: var(--text-primary);
    }

    .btn-secondary:hover {
      background: var(--amazon-blue);
    }

    .btn-break {
      background: linear-gradient(135deg, #F85149 0%, #da3633 100%);
      color: white;
      padding: 1rem 2rem;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .btn-break:hover {
      background: linear-gradient(135deg, #da3633 0%, #b62324 100%);
      box-shadow: 0 4px 12px rgba(248, 81, 73, 0.4);
    }

    .btn-break svg {
      width: 24px;
      height: 24px;
    }

    .btn-reset {
      background: linear-gradient(135deg, #6e7681 0%, #484f58 100%);
      color: white;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-reset:hover {
      background: linear-gradient(135deg, #484f58 0%, #30363d 100%);
      box-shadow: 0 4px 12px rgba(110, 118, 129, 0.4);
    }

    .btn-reset svg {
      width: 20px;
      height: 20px;
    }

    .btn-sync {
      background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
      color: white;
      padding: 1rem 1.5rem;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-sync:hover {
      background: linear-gradient(135deg, #2ea043 0%, #3fb950 100%);
      box-shadow: 0 4px 12px rgba(46, 160, 67, 0.4);
    }

    .btn-sync svg {
      width: 20px;
      height: 20px;
    }

    .sync-status {
      font-size: 1.25rem;
      padding: 0.5rem;
      transition: color 0.3s;
    }

    .btn-report {
      background: linear-gradient(135deg, var(--purple) 0%, #7C3AED 100%);
      color: white;
      padding: 1rem 2rem;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .btn-report:hover {
      background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%);
      box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
    }

    .btn-report svg {
      width: 24px;
      height: 24px;
    }

    .btn-voice {
      background: linear-gradient(135deg, var(--amazon-teal) 0%, #008080 100%);
      color: white;
      padding: 1rem 2rem;
      font-size: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .btn-voice:hover {
      background: linear-gradient(135deg, #008080 0%, #006666 100%);
      box-shadow: 0 4px 12px rgba(0, 168, 168, 0.4);
    }

    .btn-voice svg {
      width: 24px;
      height: 24px;
    }

    .btn-voice.listening {
      background: linear-gradient(135deg, var(--success) 0%, #2da44e 100%);
      animation: pulse-voice 1.5s infinite;
    }

    @keyframes pulse-voice {
      0%, 100% { box-shadow: 0 0 0 0 rgba(63, 185, 80, 0.4); }
      50% { box-shadow: 0 0 0 15px rgba(63, 185, 80, 0); }
    }

    /* Voice Feedback Toast */
    .voice-toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      border: 2px solid var(--amazon-teal);
      border-radius: 12px;
      padding: 1rem 2rem;
      display: none;
      align-items: center;
      gap: 1rem;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      max-width: 90%;
    }

    .voice-toast.active {
      display: flex;
    }

    .voice-toast.success {
      border-color: var(--success);
    }

    .voice-toast.error {
      border-color: var(--danger);
    }

    .voice-toast-icon {
      font-size: 1.5rem;
    }

    .voice-toast-text {
      font-size: 1.1rem;
      font-weight: 500;
    }

    .voice-toast-text .heard {
      color: var(--amazon-orange);
      font-weight: 700;
    }

    .voice-toast-text .action {
      color: var(--text-secondary);
      font-size: 0.9rem;
      display: block;
      margin-top: 0.25rem;
    }

    /* Voice Help Modal */
    .voice-help {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-card);
      border: 2px solid var(--amazon-teal);
      border-radius: 16px;
      padding: 2rem;
      z-index: 1001;
      max-width: 500px;
      width: 90%;
      display: none;
    }

    .voice-help.active {
      display: block;
    }

    .voice-help h3 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      color: var(--amazon-teal);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .voice-help-commands {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .voice-cmd {
      background: var(--input-bg);
      padding: 0.75rem 1rem;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .voice-cmd code {
      color: var(--amazon-orange);
      font-family: monospace;
      font-size: 1rem;
    }

    .voice-cmd span {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.85);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      padding: 2rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: var(--bg-card);
      border-radius: 16px;
      max-width: 900px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 2px solid var(--amazon-orange);
      animation: modalSlideIn 0.3s ease;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      background: linear-gradient(135deg, #F85149 0%, #da3633 100%);
      padding: 1.5rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 8px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .modal-close:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .modal-body {
      padding: 2rem;
    }

    .break-stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .break-stat-card {
      background: var(--input-bg);
      border-radius: 12px;
      padding: 1.5rem;
      text-align: center;
      border: 2px solid var(--border-color);
    }

    .break-stat-card.highlight {
      border-color: var(--amazon-orange);
      background: linear-gradient(135deg, rgba(255, 153, 0, 0.1) 0%, rgba(255, 153, 0, 0.05) 100%);
    }

    .break-stat-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
    }

    .break-stat-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 3rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .break-stat-value.orange {
      color: var(--amazon-orange);
    }

    .break-stat-value.teal {
      color: var(--amazon-teal);
    }

    .break-stat-value.danger {
      color: var(--danger);
    }

    .break-stat-value.success {
      color: var(--success);
    }

    .break-stat-unit {
      font-size: 1rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    .flow-required-section {
      background: linear-gradient(135deg, var(--amazon-blue) 0%, var(--amazon-blue-light) 100%);
      border-radius: 12px;
      padding: 1.5rem;
      margin-top: 1.5rem;
      border: 2px solid var(--amazon-orange);
    }

    .flow-required-title {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 1rem;
      color: var(--amazon-orange);
    }

    .flow-required-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .flow-required-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .flow-required-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .flow-required-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    .time-remaining {
      text-align: center;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      margin-top: 1rem;
    }

    .time-remaining-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 0.25rem;
    }

    .time-remaining-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--success);
    }

    /* Break Copy Section */
    .break-copy-section {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
      padding-top: 1.5rem;
      border-top: 2px solid var(--border-color);
    }

    .btn-copy-break {
      background: linear-gradient(135deg, var(--amazon-teal) 0%, #008080 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.875rem 1.5rem;
      font-family: 'Barlow', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .btn-copy-break:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 168, 168, 0.4);
    }

    .btn-copy-break svg {
      width: 20px;
      height: 20px;
    }

    .break-copy-confirm {
      color: var(--success);
      font-weight: 600;
      font-size: 1rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .break-copy-confirm.show {
      opacity: 1;
    }

    /* Hourly Update Section */
    .hourly-update-section {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      border: 2px solid var(--success);
    }

    .hourly-update-section .section-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--success);
      flex-wrap: wrap;
    }

    .hourly-update-section .section-title {
      color: var(--success);
      flex: 1;
    }

    .hourly-update-section .section-title::before {
      background: var(--success);
    }

    .btn-copy-hourly {
      background: linear-gradient(135deg, var(--success) 0%, #2da44e 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.2rem;
      font-family: 'Barlow', sans-serif;
      font-size: 0.9rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .btn-copy-hourly:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(63, 185, 80, 0.4);
    }

    .hourly-copy-confirm {
      color: var(--success);
      font-weight: 600;
      font-size: 0.9rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .hourly-copy-confirm.show {
      opacity: 1;
    }

    .hourly-update-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 1rem;
    }

    .hourly-stat {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }

    .hourly-stat.highlight {
      background: rgba(255, 153, 0, 0.15);
      border: 2px solid var(--amazon-orange);
    }

    .hourly-label {
      display: block;
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      margin-bottom: 0.25rem;
    }

    .hourly-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--success);
    }

    .hourly-value.orange {
      color: var(--amazon-orange);
    }

    .hourly-stat.highlight .hourly-value {
      color: var(--amazon-orange);
      font-size: 1.75rem;
    }

    .hourly-sub {
      display: block;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    /* 9 AM Row Styles */
    .hourly-9am-row {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 2rem;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(139, 92, 246, 0.15);
      border: 2px solid var(--purple);
      border-radius: 10px;
    }

    .nine-am-stat {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .nine-am-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .nine-am-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--purple);
    }

    .nine-am-stat.highlight-9am {
      background: rgba(139, 92, 246, 0.2);
      padding: 0.5rem 1rem;
      border-radius: 8px;
      border: 2px solid var(--purple);
    }

    .nine-am-stat.highlight-9am .nine-am-value {
      font-size: 2rem;
      color: #A78BFA;
    }

    .nine-am-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-left: 0.25rem;
    }

    .finish-time-input {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .finish-time-input label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      font-weight: 600;
    }

    .finish-time-input input {
      background: var(--input-bg);
      border: 2px solid var(--success);
      border-radius: 6px;
      padding: 0.4rem 0.6rem;
      color: var(--success);
      font-family: 'Barlow', sans-serif;
      font-size: 1rem;
      font-weight: 600;
    }

    .finish-time-input input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(63, 185, 80, 0.3);
    }

    @media (max-width: 900px) {
      .hourly-update-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .hourly-update-section .section-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 600px) {
      .hourly-update-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Report Modal Styles */
    .report-modal {
      max-width: 600px;
    }

    .report-preview {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 1.5rem;
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
      line-height: 1.6;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }

    .report-preview .report-header {
      color: var(--amazon-orange);
      font-weight: bold;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .report-preview .report-section {
      margin: 1rem 0;
      padding: 0.75rem;
      background: rgba(255, 153, 0, 0.1);
      border-radius: 8px;
    }

    .report-preview .report-section-title {
      color: var(--amazon-teal);
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .report-preview .report-line {
      display: flex;
      justify-content: space-between;
      padding: 0.25rem 0;
    }

    .report-preview .report-label {
      color: var(--text-secondary);
    }

    .report-preview .report-value {
      color: var(--text-primary);
      font-weight: bold;
    }

    .report-preview .report-value.highlight {
      color: var(--amazon-orange);
    }

    .report-preview .report-value.success {
      color: var(--success);
    }

    .report-preview .report-value.warning {
      color: var(--warning);
    }

    .report-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .btn-copy {
      background: linear-gradient(135deg, var(--purple) 0%, #7C3AED 100%);
      color: white;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 1rem 2rem;
      font-size: 1.1rem;
    }

    .btn-copy:hover {
      background: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%);
    }

    .copy-confirm {
      color: var(--success);
      font-weight: 600;
      font-size: 1.1rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .copy-confirm.show {
      opacity: 1;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .volume-section {
        grid-template-columns: 1fr;
      }
      
      .progress-section {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .header {
        flex-direction: column;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        text-align: center;
      }

      .header-left {
        flex-direction: row;
        justify-content: center;
        gap: 0.5rem;
      }

      .header-right {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.5rem;
        width: 100%;
      }

      .header-right .btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.7rem;
      }

      .header-right .btn svg {
        width: 14px;
        height: 14px;
      }

      .btn-voice, .btn-report, .btn-break, .btn-reset, .btn-sync {
        padding: 0.5rem 0.75rem !important;
        font-size: 0.75rem !important;
      }

      .btn-voice svg, .btn-report svg, .btn-break svg, .btn-reset svg, .btn-sync svg {
        width: 16px !important;
        height: 16px !important;
      }

      .sync-status {
        font-size: 1rem;
        padding: 0.25rem;
      }

      .header-time {
        text-align: center;
        margin-top: 0.25rem;
      }

      .current-time {
        font-size: 1.25rem;
      }

      .current-date {
        font-size: 0.75rem;
      }

      .logo-icon {
        width: 35px;
        height: 35px;
        font-size: 1rem;
      }

      .logo-text {
        font-size: 1rem;
      }

      .home-btn {
        padding: 0.4rem 0.75rem;
        font-size: 0.75rem;
      }

      .staffing-section {
        grid-template-columns: 1fr;
      }

      .break-stats-grid {
        grid-template-columns: 1fr;
      }

      .flow-required-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Extra small screens */
    @media (max-width: 480px) {
      .header {
        padding: 0.5rem;
        gap: 0.4rem;
      }

      .header-left {
        gap: 0.4rem;
      }

      .logo-icon {
        width: 30px;
        height: 30px;
        font-size: 0.9rem;
      }

      .logo-text {
        font-size: 0.9rem;
      }

      .logo-text span {
        font-size: 0.9rem;
      }

      .home-btn {
        padding: 0.3rem 0.5rem;
        font-size: 0.65rem;
      }

      .header-right {
        gap: 0.4rem;
      }

      .btn-voice, .btn-report, .btn-break, .btn-reset, .btn-sync {
        padding: 0.4rem 0.6rem !important;
        font-size: 0.65rem !important;
        gap: 0.3rem !important;
      }

      .btn-voice svg, .btn-report svg, .btn-break svg, .btn-reset svg, .btn-sync svg {
        width: 12px !important;
        height: 12px !important;
      }

      .sync-status {
        font-size: 0.85rem;
      }

      .current-time {
        font-size: 1rem;
      }

      .live-indicator {
        font-size: 0.65rem;
        padding: 0.15rem 0.5rem;
      }

      .container {
        padding: 0.5rem;
      }
    }

    /* Animations */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .live-indicator::before {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    /* Back Button */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--amazon-blue-light);
      color: var(--text-primary);
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1.25rem;
      font-family: 'Barlow', sans-serif;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
    }

    .back-btn:hover {
      background: var(--amazon-orange);
      color: var(--amazon-blue);
    }

    .back-btn svg {
      width: 18px;
      height: 18px;
    }

    /* Pre-Shift Planner Section */
    .preshift-planner {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 2px solid var(--success);
    }

    .preshift-planner .section-header {
      border-bottom-color: var(--success);
    }

    .preshift-planner .section-title {
      color: var(--success);
    }

    .preshift-planner .section-title::before {
      background: var(--success);
    }

    .preshift-grid {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .preshift-card {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1.25rem;
      border: 1px solid var(--border-color);
    }

    .preshift-card h4 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .preshift-card.calculated {
      border-color: var(--amazon-teal);
      background: rgba(0, 168, 168, 0.1);
    }

    .preshift-card.calculated h4 {
      color: var(--amazon-teal);
    }

    .preshift-inputs {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .preshift-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
    }

    .preshift-input-item {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .preshift-input-item label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .preshift-input-item input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
      text-align: center;
    }

    .preshift-input-item input:focus {
      outline: none;
      border-color: var(--success);
      box-shadow: 0 0 0 3px rgba(63, 185, 80, 0.2);
    }

    .model-results {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .model-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 0.75rem;
      text-align: center;
    }

    .model-item span {
      display: block;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .model-item strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--amazon-teal);
    }

    .model-item small {
      display: block;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Same Day Addition */
    .sameday-addition {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: 10px;
      padding: 1.25rem;
      margin-bottom: 1rem;
    }

    .sameday-addition h4 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--purple);
      margin-bottom: 1rem;
    }

    .sameday-add-row {
      display: flex;
      gap: 1.5rem;
      align-items: flex-start;
    }

    .sameday-add-input {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .sameday-add-input label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .sameday-add-input input {
      background: var(--input-bg);
      border: 2px solid var(--purple);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      color: var(--purple);
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      width: 150px;
      text-align: center;
    }

    .sameday-add-input input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
    }

    .sameday-add-result {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      flex: 1;
    }

    .add-result-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 0.75rem 1rem;
      text-align: center;
      min-width: 120px;
    }

    .add-result-item span {
      display: block;
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .add-result-item strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .add-result-item.highlight {
      background: rgba(255, 153, 0, 0.2);
      border: 1px solid var(--amazon-orange);
    }

    .add-result-item.highlight strong {
      color: var(--amazon-orange);
    }

    .add-result-item.extra {
      background: rgba(63, 185, 80, 0.2);
      border: 1px solid var(--success);
    }

    .add-result-item.extra strong {
      color: var(--success);
      font-size: 1.75rem;
    }

    .apply-preshift {
      display: flex;
      justify-content: center;
    }

    .apply-preshift .btn {
      background: linear-gradient(135deg, var(--success) 0%, #2da44e 100%);
      color: white;
      padding: 0.75rem 2rem;
    }

    @media (max-width: 900px) {
      .preshift-grid {
        grid-template-columns: 1fr;
      }
      .preshift-row {
        grid-template-columns: repeat(2, 1fr);
      }
      .sameday-add-row {
        flex-direction: column;
      }
      .sameday-add-result {
        width: 100%;
      }
    }

    /* Staffing Summary Panel */
    .staffing-summary {
      background: linear-gradient(135deg, var(--amazon-blue) 0%, var(--amazon-blue-light) 100%);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 2px solid var(--amazon-orange);
    }

    .staffing-summary .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid rgba(255, 153, 0, 0.3);
    }

    .staffing-summary .section-title {
      color: var(--amazon-orange);
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    .staffing-summary .section-title::before {
      background: var(--amazon-orange);
    }

    .rates-source {
      background: rgba(255, 153, 0, 0.2);
      color: var(--amazon-orange);
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .rates-source.custom {
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
    }

    /* C1 Volume Entry */
    .c1-volume-entry {
      display: flex;
      justify-content: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid rgba(255, 153, 0, 0.3);
    }

    .c1-volume-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }

    .c1-volume-group label {
      font-size: 1rem;
      font-weight: 600;
      color: var(--amazon-orange);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .c1-volume-group input {
      background: rgba(0, 0, 0, 0.4);
      border: 3px solid var(--amazon-orange);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      color: var(--amazon-orange);
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 3rem;
      font-weight: 800;
      text-align: center;
      width: 280px;
      transition: all 0.2s;
    }

    .c1-volume-group input:focus {
      outline: none;
      box-shadow: 0 0 0 4px rgba(255, 153, 0, 0.3);
    }

    .c1-volume-group input::placeholder {
      color: var(--text-muted);
      font-size: 2rem;
    }

    .summary-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .summary-stat {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .summary-stat-label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.25rem;
    }

    .summary-stat-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .summary-stat-value.highlight {
      color: var(--amazon-orange);
    }

    .staffing-recommendation {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
    }

    .rec-group {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      padding: 1rem;
    }

    .rec-group h4 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--amazon-teal);
      margin-bottom: 0.75rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(0, 168, 168, 0.3);
    }

    .rec-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .rec-item:last-child {
      border-bottom: none;
    }

    .rec-item span {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .rec-item strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    .rec-item small {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-left: 0.25rem;
    }

    .rec-item.total {
      margin-top: 0.5rem;
      padding-top: 0.75rem;
      border-top: 2px solid rgba(255, 153, 0, 0.3);
    }

    .rec-item.total strong {
      font-size: 1.75rem;
    }

    .rec-item.highlight strong {
      color: var(--success);
      font-size: 2rem;
    }

    .rec-group.stow-group {
      background: rgba(0, 168, 168, 0.1);
      border: 1px solid rgba(0, 168, 168, 0.3);
    }

    .rec-group.stow-group h4 {
      color: var(--amazon-teal);
      border-bottom-color: rgba(0, 168, 168, 0.3);
    }

    .rec-group.total-group {
      background: rgba(255, 153, 0, 0.15);
      border: 2px solid var(--amazon-orange);
    }

    .rec-group.total-group h4 {
      color: var(--amazon-orange);
      border-bottom-color: rgba(255, 153, 0, 0.3);
    }

    /* Stow Settings */
    .stow-settings {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      padding: 1rem;
      background: rgba(0, 168, 168, 0.1);
      border-radius: 10px;
      border: 1px solid rgba(0, 168, 168, 0.3);
      align-items: flex-end;
    }

    .stow-setting {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .stow-setting label {
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stow-setting input {
      background: var(--input-bg);
      border: 2px solid var(--amazon-teal);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: var(--amazon-teal);
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      width: 100px;
      text-align: center;
    }

    .stow-setting input:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 168, 168, 0.2);
    }

    .stow-setting.result {
      background: rgba(0, 0, 0, 0.3);
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    .stow-setting.result span {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    .summary-stat-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: -0.25rem;
    }

    /* Same Day Section */
    .sameday-section {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 2px solid var(--purple);
    }

    .sameday-section .section-header {
      border-bottom-color: var(--purple);
    }

    .sameday-section .section-title {
      color: var(--purple);
    }

    .sameday-section .section-title::before {
      background: var(--purple);
    }

    .ssd-status {
      background: rgba(139, 92, 246, 0.2);
      color: var(--purple);
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .ssd-status.active {
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
    }

    .ssd-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .ssd-card {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 1.25rem;
      border: 1px solid var(--border-color);
    }

    .ssd-card h3 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .ssd-card.sunrise {
      border-color: rgba(255, 183, 77, 0.5);
    }

    .ssd-card.sunrise h3 {
      color: #FFB74D;
    }

    .ssd-card.sameday-am {
      border-color: rgba(139, 92, 246, 0.5);
    }

    .ssd-card.sameday-am h3 {
      color: var(--purple);
    }

    .ssd-card.staffing-card {
      border-color: var(--amazon-orange);
      background: rgba(255, 153, 0, 0.1);
    }

    .ssd-card.staffing-card h3 {
      color: var(--amazon-orange);
    }

    .ssd-inputs {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .ssd-input-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .ssd-input-group label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .ssd-input-group input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 6px;
      padding: 0.5rem 0.75rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1rem;
      font-weight: 600;
    }

    .ssd-input-group input:focus {
      outline: none;
      border-color: var(--purple);
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
    }

    .ssd-results {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .ssd-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }

    .ssd-result span {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .ssd-result strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    .ssd-result small {
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-left: 0.25rem;
    }

    .ssd-progress {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 1rem;
      padding: 0.75rem;
      background: rgba(0, 168, 168, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(0, 168, 168, 0.3);
    }

    .ssd-progress .ssd-input-group label {
      color: var(--amazon-teal);
    }

    .btn-copy-ssd {
      width: 100%;
      margin-top: 1rem;
      background: linear-gradient(135deg, var(--purple) 0%, #7C3AED 100%);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 0.6rem 1rem;
      font-family: 'Barlow', sans-serif;
      font-size: 0.85rem;
      font-weight: 700;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }

    .btn-copy-ssd:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.4);
    }

    .ssd-copy-confirm {
      display: block;
      text-align: center;
      color: var(--success);
      font-weight: 600;
      font-size: 0.85rem;
      margin-top: 0.5rem;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .ssd-copy-confirm.show {
      opacity: 1;
    }

    .ssd-staffing-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .ssd-staff-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0.75rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
    }

    .ssd-staff-item span {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .ssd-staff-item strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .ssd-staff-item.total {
      grid-column: span 2;
      background: rgba(255, 153, 0, 0.2);
      border: 1px solid var(--amazon-orange);
    }

    .ssd-staff-item.total strong {
      color: var(--amazon-orange);
      font-size: 1.5rem;
    }

    .ssd-note {
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(248, 81, 73, 0.15);
      border: 1px solid rgba(248, 81, 73, 0.3);
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .ssd-note span {
      color: var(--danger);
    }

    .ssd-note strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--danger);
    }

    /* C1 Adjusted Section */
    .c1-adjusted {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem 1.25rem;
      border: 1px solid var(--border-color);
    }

    .c1-adjusted h4 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--warning);
      margin-bottom: 0.75rem;
    }

    .c1-adjusted-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
    }

    .c1-adj-item {
      text-align: center;
      padding: 0.75rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }

    .c1-adj-item span {
      font-size: 0.75rem;
      color: var(--text-muted);
      display: block;
      margin-bottom: 0.25rem;
    }

    .c1-adj-item strong {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-primary);
    }

    .c1-adj-item small {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .c1-adj-item.highlight {
      background: rgba(210, 153, 34, 0.2);
      border: 1px solid var(--warning);
    }

    .c1-adj-item.highlight strong {
      color: var(--warning);
    }

    @media (max-width: 1000px) {
      .ssd-grid {
        grid-template-columns: 1fr;
      }
      .c1-adjusted-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* WIP Compliance Section */
    .wip-section {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 2px solid var(--warning);
    }

    .wip-section .section-header {
      border-bottom-color: var(--warning);
    }

    .wip-section .section-title {
      color: var(--warning);
    }

    .wip-section .section-title::before {
      background: var(--warning);
    }

    .wip-status {
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      background: rgba(139, 148, 158, 0.2);
      color: var(--text-muted);
    }

    .wip-status.compliant {
      background: rgba(63, 185, 80, 0.2);
      color: var(--success);
    }

    .wip-status.warning {
      background: rgba(210, 153, 34, 0.2);
      color: var(--warning);
    }

    .wip-status.critical {
      background: rgba(248, 81, 73, 0.2);
      color: var(--danger);
    }

    .wip-grid {
      display: grid;
      grid-template-columns: 1fr 1fr 1.5fr;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .wip-card {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: 1.25rem;
      border: 1px solid var(--border-color);
    }

    .wip-card h4 {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .wip-card.targets {
      border-color: rgba(210, 153, 34, 0.3);
    }

    .wip-card.targets h4 {
      color: var(--warning);
    }

    .wip-card.result {
      border-color: var(--amazon-teal);
      background: rgba(0, 168, 168, 0.1);
    }

    .wip-card.result h4 {
      color: var(--amazon-teal);
    }

    .wip-input-row {
      display: flex;
      gap: 1rem;
    }

    .wip-input-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .wip-input-item label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }

    .wip-input-item input {
      background: var(--input-bg);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 0.75rem;
      color: var(--text-primary);
      font-family: 'Barlow', sans-serif;
      font-size: 1.25rem;
      font-weight: 600;
      text-align: center;
    }

    .wip-input-item input:focus {
      outline: none;
      border-color: var(--warning);
      box-shadow: 0 0 0 3px rgba(210, 153, 34, 0.2);
    }

    /* Buffer Display */
    .buffer-display {
      text-align: center;
    }

    .buffer-minutes {
      margin-bottom: 1rem;
    }

    .buffer-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 3.5rem;
      font-weight: 800;
      color: var(--amazon-teal);
    }

    .buffer-value.low {
      color: var(--danger);
    }

    .buffer-value.good {
      color: var(--success);
    }

    .buffer-value.high {
      color: var(--warning);
    }

    .buffer-label {
      font-size: 1rem;
      color: var(--text-muted);
      margin-left: 0.5rem;
    }

    .buffer-bar-container {
      position: relative;
      margin: 0.5rem 0;
    }

    .buffer-bar-bg {
      display: flex;
      height: 20px;
      border-radius: 10px;
      overflow: hidden;
    }

    .buffer-zone {
      height: 100%;
    }

    .buffer-zone.low {
      flex: 1;
      background: rgba(248, 81, 73, 0.4);
    }

    .buffer-zone.target {
      flex: 1;
      background: rgba(63, 185, 80, 0.4);
    }

    .buffer-zone.high {
      flex: 1;
      background: rgba(210, 153, 34, 0.4);
    }

    .buffer-marker {
      position: absolute;
      top: -5px;
      width: 4px;
      height: 30px;
      background: white;
      border-radius: 2px;
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
      transition: left 0.3s ease;
      left: 0%;
    }

    .buffer-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* WIP Actions */
    .wip-actions {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: 1rem 1.25rem;
      border-left: 4px solid var(--text-muted);
    }

    .wip-actions.action-increase {
      border-left-color: var(--danger);
      background: rgba(248, 81, 73, 0.1);
    }

    .wip-actions.action-hold {
      border-left-color: var(--success);
      background: rgba(63, 185, 80, 0.1);
    }

    .wip-actions.action-decrease {
      border-left-color: var(--warning);
      background: rgba(210, 153, 34, 0.1);
    }

    .wip-action-title {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 1rem;
      font-weight: 700;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    .wip-action-text {
      font-size: 0.95rem;
      color: var(--text-primary);
      line-height: 1.5;
    }

    @media (max-width: 900px) {
      .wip-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 900px) {
      .summary-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      .staffing-recommendation {
        grid-template-columns: 1fr;
      }
      .stow-settings {
        flex-wrap: wrap;
      }
    }

    /* Real Time Stats */
    .real-time-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 1.25rem;
      text-align: center;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--amazon-orange);
    }

    .stat-value {
      font-family: 'Barlow Condensed', sans-serif;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--amazon-orange);
    }

    .stat-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 0.25rem;
    }

    @media (max-width: 1200px) {
      .real-time-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .real-time-stats {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="logo">
      <a href="index.html" class="back-btn">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        Home
      </a>
      <div class="logo-icon">PPH</div>
      <div class="logo-text">PPH <span>Flow Staffing</span></div>
    </div>
    <div class="header-right">
      <button class="btn btn-voice" id="voiceBtn" onclick="toggleVoice()">
        <svg id="micIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
        </svg>
        <span id="voiceBtnText">VOICE</span>
      </button>
      <button class="btn btn-report" onclick="openReportModal()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        HOURLY
      </button>
      <button class="btn btn-break" onclick="openBreakModal()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        BREAK
      </button>
      <button class="btn btn-reset" onclick="resetAllData()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        RESET
      </button>
      <button class="btn btn-sync" onclick="loadFromCloud()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
        </svg>
        SYNC
      </button>
      <span id="syncStatus" class="sync-status"></span>
      <div class="header-time">
        <div class="live-indicator">Live</div>
        <div class="current-time" id="currentTime">--:--:--</div>
        <div class="current-date" id="currentDate">Loading...</div>
      </div>
    </div>
  </header>

  <div class="container">
    <!-- Pre-Shift Planner Section -->
    <section class="preshift-planner">
      <div class="section-header">
        <h2 class="section-title"> Pre-Shift Planner</h2>
        <button class="btn btn-secondary" onclick="clearPreshift()" style="font-size: 0.85rem; padding: 0.5rem 1rem;">Clear</button>
      </div>
      
      <div class="preshift-grid">
        <div class="preshift-card">
          <h4> Pre-Shift Data (Paste from Slack)</h4>
          <div class="preshift-inputs">
            <div class="preshift-row">
              <div class="preshift-input-item">
                <label>C1 Volume</label>
                <input type="number" id="preshiftVolume" placeholder="0" oninput="calculatePreshift()">
              </div>
              <div class="preshift-input-item">
                <label>FPH</label>
                <input type="number" id="preshiftFPH" placeholder="0" oninput="calculatePreshift()">
              </div>
              <div class="preshift-input-item">
                <label>Planned HC</label>
                <input type="number" id="preshiftPlannedHC" placeholder="0" oninput="calculatePreshift()">
              </div>
            </div>
            <div class="preshift-row">
              <div class="preshift-input-item">
                <label>Planned Hours</label>
                <input type="number" id="preshiftPlannedHours" placeholder="0" oninput="calculatePreshift()">
              </div>
              <div class="preshift-input-item">
                <label>Projected Hours</label>
                <input type="number" id="preshiftProjectedHours" placeholder="0" oninput="calculatePreshift()">
              </div>
              <div class="preshift-input-item">
                <label>Target TPH</label>
                <input type="number" id="preshiftTPH" value="90" oninput="calculatePreshift()">
              </div>
            </div>
          </div>
        </div>

        <div class="preshift-card calculated">
          <h4> Calculated Model</h4>
          <div class="model-results">
            <div class="model-item">
              <span>Direct Hours</span>
              <strong id="modelDirectHours">0</strong>
              <small>(Volume  TPH)</small>
            </div>
            <div class="model-item">
              <span>Indirect Factor</span>
              <strong id="modelIndirectFactor">1.17</strong>
              <small>(Planned  Direct)</small>
            </div>
            <div class="model-item">
              <span>Hours per AA</span>
              <strong id="modelHoursPerAA">7.2</strong>
              <small>(Planned Hrs  HC)</small>
            </div>
            <div class="model-item">
              <span>Hours Gap</span>
              <strong id="modelHoursGap">0</strong>
              <small>(Projected - Planned)</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Same Day Addition -->
      <div class="sameday-addition">
        <h4> Add Same Day Volume</h4>
        <div class="sameday-add-row">
          <div class="sameday-add-input">
            <label>Same Day Volume</label>
            <input type="number" id="addSamedayVolume" placeholder="0" oninput="calculateWithSameday()">
          </div>
          <div class="sameday-add-result">
            <div class="add-result-item">
              <span>New Total Volume</span>
              <strong id="newTotalVolume">0</strong>
            </div>
            <div class="add-result-item">
              <span>New Planned Hours</span>
              <strong id="newPlannedHours">0</strong>
            </div>
            <div class="add-result-item highlight">
              <span>New Planned HC</span>
              <strong id="newPlannedHC">0</strong>
            </div>
            <div class="add-result-item extra">
              <span>Extra HC Needed</span>
              <strong id="extraHCNeeded">+0</strong>
            </div>
          </div>
        </div>
      </div>

      <!-- Apply to Staffing -->
      <div class="apply-preshift">
        <button class="btn" onclick="applyPreshiftToStaffing()">
          Apply C1 Volume to Staffing Calculator 
        </button>
      </div>
    </section>

    <!-- Staffing Recommendation Summary -->
    <section class="staffing-summary" id="staffingSummary">
      <div class="section-header">
        <h2 class="section-title"> Staffing Needed to Meet Rate</h2>
        <span class="rates-source" id="ratesSource">Using Default Rates</span>
      </div>
      
      <!-- C1 Volume Entry -->
      <div class="c1-volume-entry">
        <div class="c1-volume-group">
          <label>C1 Volume (Total Night)</label>
          <input type="number" id="totalVolume" placeholder="0" oninput="updateStats()">
        </div>
      </div>

      <div class="summary-stats">
        <div class="summary-stat">
          <div class="summary-stat-label">Volume</div>
          <div class="summary-stat-value" id="summaryVolume">0</div>
        </div>
        <div class="summary-stat">
          <div class="summary-stat-label">Run Time</div>
          <div class="summary-stat-value" id="summaryRunTime">0h</div>
        </div>
        <div class="summary-stat">
          <div class="summary-stat-label">Required Flow</div>
          <div class="summary-stat-value highlight" id="summaryTPH">0</div>
          <div class="summary-stat-sub">TPH</div>
        </div>
        <div class="summary-stat">
          <div class="summary-stat-label">Total HC Needed</div>
          <div class="summary-stat-value highlight" id="summaryTotalHC">0</div>
        </div>
      </div>
      
      <!-- Stow Rate Settings -->
      <div class="stow-settings">
        <div class="stow-setting">
          <label>Stow Rate (PPH)</label>
          <input type="number" id="stowRatePPH" placeholder="260" oninput="updateStats()">
        </div>
        <div class="stow-setting">
          <label>Efficiency %</label>
          <input type="number" id="efficiencyPercent" placeholder="85" min="1" max="100" oninput="updateStats()">
        </div>
        <div class="stow-setting result">
          <label>Effective Stow PPH</label>
          <span id="effectiveStowPPH">221</span>
        </div>
      </div>

      <div class="staffing-recommendation">
        <div class="rec-group">
          <h4> Dock Side</h4>
          <div class="rec-item"><span>Waterspiders</span><strong id="recWaterspider">0</strong></div>
          <div class="rec-item"><span>Line Loaders</span><strong id="recLineloader">0</strong></div>
          <div class="rec-item"><span>Inducters</span><strong id="recInducters">0</strong></div>
          <div class="rec-item"><span>Pushers</span><strong id="recPushers">0</strong></div>
          <div class="rec-item"><span>Diverters</span><strong id="recDiverter">0</strong></div>
          <div class="rec-item total"><span>Dock Total</span><strong id="recInductTotal">0</strong></div>
        </div>
        <div class="rec-group stow-group">
          <h4> Sort Side</h4>
          <div class="rec-item"><span>Required Stow Flow</span><strong id="recStowFlow">0</strong><small>PPH</small></div>
          <div class="rec-item"><span>Effective Rate/Person</span><strong id="recEffectiveRate">0</strong><small>PPH</small></div>
          <div class="rec-item total highlight"><span>Stowers Needed</span><strong id="recStowers">0</strong></div>
        </div>
        <div class="rec-group total-group">
          <h4> Total Headcount</h4>
          <div class="rec-item"><span>Dock HC</span><strong id="recInductHC">0</strong></div>
          <div class="rec-item"><span>Sort HC</span><strong id="recStowHC">0</strong></div>
          <div class="rec-item total highlight"><span>TOTAL HC</span><strong id="recTotalHC">0</strong></div>
        </div>
      </div>
    </section>

    <!-- Same Day Operations Section -->
    <section class="sameday-section">
      <div class="section-header">
        <h2 class="section-title"> Same Day Operations</h2>
        <span class="ssd-status" id="ssdStatus">Not Started</span>
      </div>
      
      <div class="ssd-grid">
        <!-- Sunrise -->
        <div class="ssd-card sunrise">
          <h3> Sunrise</h3>
          <div class="ssd-inputs">
            <div class="ssd-input-group">
              <label>Volume</label>
              <input type="number" id="sunriseVolume" placeholder="0" oninput="calculateSameDay()">
            </div>
            <div class="ssd-input-group">
              <label>Must Finish By</label>
              <input type="time" id="sunriseDeadline" value="03:30" onchange="calculateSameDay()">
            </div>
          </div>
          <div class="ssd-progress">
            <div class="ssd-input-group">
              <label>Inducted So Far</label>
              <input type="number" id="sunriseInducted" placeholder="0" oninput="updateSunriseProgress()">
            </div>
            <div class="ssd-input-group">
              <label>Stowed So Far</label>
              <input type="number" id="sunriseStowed" placeholder="0" oninput="updateSunriseProgress()">
            </div>
          </div>
          <div class="ssd-results">
            <div class="ssd-result">
              <span>Time Window</span>
              <strong id="sunriseWindow">2h 10m</strong>
            </div>
            <div class="ssd-result">
              <span>Required Flow</span>
              <strong id="sunriseFlow">0</strong>
              <small>TPH</small>
            </div>
            <div class="ssd-result">
              <span>Left to Induct</span>
              <strong id="sunriseLeftInduct">0</strong>
            </div>
            <div class="ssd-result">
              <span>Left to Stow</span>
              <strong id="sunriseLeftStow">0</strong>
            </div>
          </div>
          <button class="btn btn-copy-ssd" onclick="copySunriseUpdate()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            Copy Sunrise Update
          </button>
          <span class="ssd-copy-confirm" id="sunriseCopyConfirm"> Copied!</span>
        </div>

        <!-- Same Day AM -->
        <div class="ssd-card sameday-am">
          <h3> Same Day AM</h3>
          <div class="ssd-inputs">
            <div class="ssd-input-group">
              <label>Volume</label>
              <input type="number" id="samedayVolume" placeholder="0" oninput="calculateSameDay()">
            </div>
            <div class="ssd-input-group">
              <label>Must Start By</label>
              <input type="time" id="samedayStart" value="03:00" onchange="calculateSameDay()">
            </div>
            <div class="ssd-input-group">
              <label>Must Finish By</label>
              <input type="time" id="samedayDeadline" value="03:30" onchange="calculateSameDay()">
            </div>
          </div>
          <div class="ssd-progress">
            <div class="ssd-input-group">
              <label>Inducted So Far</label>
              <input type="number" id="samedayInducted" placeholder="0" oninput="updateSamedayProgress()">
            </div>
            <div class="ssd-input-group">
              <label>Stowed So Far</label>
              <input type="number" id="samedayStowed" placeholder="0" oninput="updateSamedayProgress()">
            </div>
          </div>
          <div class="ssd-results">
            <div class="ssd-result">
              <span>Time Window</span>
              <strong id="samedayWindow">0h 30m</strong>
            </div>
            <div class="ssd-result">
              <span>Required Flow</span>
              <strong id="samedayFlow">0</strong>
              <small>TPH</small>
            </div>
            <div class="ssd-result">
              <span>Left to Induct</span>
              <strong id="samedayLeftInduct">0</strong>
            </div>
            <div class="ssd-result">
              <span>Left to Stow</span>
              <strong id="samedayLeftStow">0</strong>
            </div>
          </div>
          <button class="btn btn-copy-ssd" onclick="copySamedayUpdate()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            Copy Same Day AM Update
          </button>
          <span class="ssd-copy-confirm" id="samedayCopyConfirm"> Copied!</span>
        </div>

        <!-- Combined SSD Staffing -->
        <div class="ssd-card staffing-card">
          <h3> SSD Staffing Needed</h3>
          <div class="ssd-staffing-grid">
            <div class="ssd-staff-item">
              <span>Pick to Buffer</span>
              <strong id="ssdP2B">6</strong>
              <small>(min 6)</small>
            </div>
            <div class="ssd-staff-item">
              <span>Stowers</span>
              <strong id="ssdStowers">0</strong>
            </div>
            <div class="ssd-staff-item total">
              <span>Total SSD HC</span>
              <strong id="ssdTotalHC">0</strong>
            </div>
          </div>
          <div class="ssd-note">
            <span> Pulled from C1 Sort Side:</span>
            <strong id="pullFromC1">0</strong>
            <span>people</span>
          </div>
        </div>
      </div>

      <!-- C1 Adjusted Flow -->
      <div class="c1-adjusted">
        <h4> C1 Adjusted (After SSD Pull)</h4>
        <div class="c1-adjusted-grid">
          <div class="c1-adj-item">
            <span>Original C1 Sort Side</span>
            <strong id="originalC1HC">0</strong>
          </div>
          <div class="c1-adj-item">
            <span>Pulled for SSD</span>
            <strong id="pulledForSSD">0</strong>
          </div>
          <div class="c1-adj-item">
            <span>Remaining C1 Sort Side</span>
            <strong id="remainingC1HC">0</strong>
          </div>
          <div class="c1-adj-item highlight">
            <span>Adjusted C1 Flow</span>
            <strong id="adjustedC1Flow">0</strong>
            <small>TPH</small>
          </div>
        </div>
      </div>
    </section>

    <!-- WIP Compliance Section -->
    <section class="wip-section">
      <div class="section-header">
        <h2 class="section-title"> WIP Compliance</h2>
        <span class="wip-status" id="wipStatus">Enter Data</span>
      </div>
      
      <div class="wip-grid">
        <!-- WIP Inputs -->
        <div class="wip-card inputs">
          <h4> Current WIP</h4>
          <div class="wip-input-row">
            <div class="wip-input-item">
              <label>WIP Units (Buffer)</label>
              <input type="number" id="wipUnits" placeholder="0" oninput="calculateWIP()">
            </div>
            <div class="wip-input-item">
              <label>Current Stow Rate (TPH)</label>
              <input type="number" id="wipStowRate" placeholder="0" oninput="calculateWIP()">
            </div>
          </div>
        </div>

        <!-- Target Range -->
        <div class="wip-card targets">
          <h4> Target Buffer Range (Minutes)</h4>
          <div class="wip-input-row">
            <div class="wip-input-item">
              <label>Min Buffer</label>
              <input type="number" id="wipTargetMin" value="10" oninput="calculateWIP()">
            </div>
            <div class="wip-input-item">
              <label>Max Buffer</label>
              <input type="number" id="wipTargetMax" value="20" oninput="calculateWIP()">
            </div>
          </div>
        </div>

        <!-- Calculated Result -->
        <div class="wip-card result">
          <h4> Buffer Status</h4>
          <div class="buffer-display">
            <div class="buffer-minutes">
              <span class="buffer-value" id="bufferMinutes">0</span>
              <span class="buffer-label">minutes</span>
            </div>
            <div class="buffer-bar-container">
              <div class="buffer-bar-bg">
                <div class="buffer-zone low"></div>
                <div class="buffer-zone target"></div>
                <div class="buffer-zone high"></div>
              </div>
              <div class="buffer-marker" id="bufferMarker"></div>
            </div>
            <div class="buffer-labels">
              <span>0</span>
              <span id="bufferMinLabel">10</span>
              <span id="bufferMaxLabel">20</span>
              <span>30+</span>
            </div>
          </div>
        </div>
      </div>

      <!-- PA Actions -->
      <div class="wip-actions" id="wipActions">
        <div class="wip-action-title"> Recommended Action</div>
        <div class="wip-action-text" id="wipActionText">Enter WIP units and stow rate to see recommendations</div>
      </div>
    </section>

    <!-- Belt Run Time Section -->
    <section class="belt-section">
      <div class="section-header">
        <h2 class="section-title">Belt Run Time</h2>
        <button class="btn btn-secondary" onclick="resetToDefault()">Reset to Default</button>
      </div>
      
      <div class="belt-grid">
        <div class="time-input-group">
          <label>Shift Start</label>
          <input type="time" class="time-input" id="shiftStart" value="01:20" onchange="calculateRunTime()">
        </div>
        <div class="time-input-group">
          <label>Shift End</label>
          <input type="time" class="time-input" id="shiftEnd" value="08:30" onchange="calculateRunTime()">
        </div>
        <div class="time-input-group">
          <label>Early End Adjustment</label>
          <input type="time" class="time-input" id="earlyEnd" placeholder="--:--" onchange="calculateRunTime()">
        </div>
        <div class="run-time-display">
          <div class="run-time-label">Total Run Time</div>
          <div class="run-time-value" id="totalRunTime">6:10</div>
          <div class="run-time-subtext">After breaks deducted</div>
        </div>
      </div>

      <div class="breaks-section">
        <h3 style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px;">Break Adjustments</h3>
        <div class="breaks-grid">
          <div class="break-item">
            <input type="checkbox" class="break-checkbox" id="break1" checked onchange="calculateRunTime()">
            <span class="break-label">1st Break (4:00-4:15)</span>
            <span class="break-time">15 min</span>
          </div>
          <div class="break-item">
            <input type="checkbox" class="break-checkbox" id="lunch" checked onchange="calculateRunTime()">
            <span class="break-label">Lunch (6:00-6:30)</span>
            <span class="break-time">30 min</span>
          </div>
          <div class="break-item">
            <input type="checkbox" class="break-checkbox" id="break2" checked onchange="calculateRunTime()">
            <span class="break-label">2nd Break (8:45-9:00)</span>
            <span class="break-time">15 min</span>
          </div>
          <div class="break-item">
            <input type="number" class="time-input" id="customBreak" value="0" min="0" style="width: 60px; padding: 0.5rem;" onchange="calculateRunTime()">
            <span class="break-label">Custom (min)</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Real Time Stats -->
    <div class="real-time-stats">
      <div class="stat-card">
        <div class="stat-value" id="statTotalVolume">0</div>
        <div class="stat-label">Total Volume</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statTotalStaff">0</div>
        <div class="stat-label">Total Staff Needed</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statRequiredTPH">0</div>
        <div class="stat-label">Required TPH</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="statRemainingVol">0</div>
        <div class="stat-label">Remaining Volume</div>
      </div>
    </div>

    <!-- Volume Entry Section -->
    <div class="volume-section">
      <div class="card">
        <div class="section-header">
          <h2 class="section-title">Stow Cluster Planned Volume</h2>
        </div>
        <div class="cluster-grid">
          <div class="cluster-input">
            <div class="cluster-label"><span class="cluster-badge">A</span> Cluster A</div>
            <input type="number" class="volume-input" id="clusterA" placeholder="0" oninput="updateStats()">
          </div>
          <div class="cluster-input">
            <div class="cluster-label"><span class="cluster-badge">B</span> Cluster B</div>
            <input type="number" class="volume-input" id="clusterB" placeholder="0" oninput="updateStats()">
          </div>
          <div class="cluster-input">
            <div class="cluster-label"><span class="cluster-badge">C</span> Cluster C</div>
            <input type="number" class="volume-input" id="clusterC" placeholder="0" oninput="updateStats()">
          </div>
          <div class="cluster-input">
            <div class="cluster-label"><span class="cluster-badge">D</span> Cluster D</div>
            <input type="number" class="volume-input" id="clusterD" placeholder="0" oninput="updateStats()">
          </div>
          <div class="cluster-input">
            <div class="cluster-label"><span class="cluster-badge">E</span> Cluster E</div>
            <input type="number" class="volume-input" id="clusterE" placeholder="0" oninput="updateStats()">
          </div>
          <div class="cluster-input">
            <div class="cluster-label"><span class="cluster-badge">G</span> Cluster G</div>
            <input type="number" class="volume-input" id="clusterG" placeholder="0" oninput="updateStats()">
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Tracking Section -->
    <div class="progress-section">
      <div class="progress-card">
        <div class="section-header">
          <h2 class="section-title">Induct Progress</h2>
        </div>
        <div class="progress-input-row">
          <div class="progress-input-group">
            <label>Units Inducted So Far</label>
            <input type="number" class="progress-input" id="inductedSoFar" placeholder="0" oninput="updateProgress()">
          </div>
          <div class="progress-input-group">
            <label>Remaining to Induct</label>
            <input type="number" class="progress-input" id="remainingInduct" placeholder="0" oninput="updateFromRemaining()" style="background: var(--amazon-blue); color: var(--amazon-orange);">
          </div>
        </div>
        <button class="btn btn-induct-complete" id="inductCompleteBtn" onclick="markInductComplete()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          INDUCT COMPLETE
        </button>
      </div>
      
      <div class="progress-card">
        <div class="section-header">
          <h2 class="section-title">Stow Progress</h2>
        </div>
        <div class="progress-input-row">
          <div class="progress-input-group">
            <label>Units Stowed So Far</label>
            <input type="number" class="progress-input" id="stowedSoFar" placeholder="0" oninput="updateProgress()">
          </div>
          <div class="progress-input-group">
            <label>Remaining to Stow</label>
            <input type="number" class="progress-input" id="remainingStow" placeholder="0" oninput="updateFromRemaining()" style="background: var(--amazon-blue); color: var(--amazon-orange);">
          </div>
        </div>
      </div>
    </div>

    <!-- Induct Complete Final Stow Panel (Hidden until induct complete) -->
    <div class="final-stow-panel" id="finalStowPanel" style="display: none;">
      <div class="final-header">
        <div class="final-title">
          <span class="final-flag"></span>
          <span>INDUCT COMPLETE</span>
        </div>
        <span class="final-time" id="finalTimeStamp">08:54 AM</span>
        <button class="btn btn-undo-induct" onclick="undoInductComplete()">Undo</button>
      </div>
      
      <div class="final-stow-list">
        <div class="final-row">
          <span class="final-icon"></span>
          <span class="final-label">Final Inducted:</span>
          <span class="final-value green" id="finalInducted">0</span>
        </div>
        <div class="final-row">
          <span class="final-icon"></span>
          <span class="final-label">Already Stowed:</span>
          <span class="final-value" id="finalAlreadyStowed">0</span>
        </div>
        <div class="final-row">
          <span class="final-icon"></span>
          <span class="final-label">Left to Stow:</span>
          <span class="final-value orange" id="finalLeftToStow">0</span>
        </div>
        <div class="final-row">
          <span class="final-icon"></span>
          <span class="final-label">Crashed/Rolled:</span>
          <span class="final-value red" id="finalCrashedRolled">0</span>
        </div>
        <div class="final-row">
          <span class="final-icon"></span>
          <span class="final-label">Time to 9 AM:</span>
          <span class="final-value purple" id="finalTimeTo9am">0:00</span>
        </div>
        <div class="final-row highlight-row">
          <span class="final-icon"></span>
          <span class="final-label">Required Stow Flow:</span>
          <span class="final-value big" id="finalStowFlow">0</span>
          <span class="final-unit">TPH</span>
        </div>
      </div>
      
      <button class="btn btn-copy-final" onclick="copyFinalStowPlan()">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
        </svg>
        Copy Final Stow Plan
      </button>
      <span class="final-copy-confirm" id="finalCopyConfirm"> Copied!</span>
    </div>

    <!-- Hourly Update Copy Section -->
    <div class="hourly-update-section">
      <div class="section-header">
        <h2 class="section-title"> Hourly Update</h2>
        <div class="finish-time-input">
          <label>Target Finish:</label>
          <input type="time" id="targetFinishTime" value="08:00" oninput="updateHourlyDisplay()">
        </div>
        <button class="btn btn-copy-hourly" onclick="copyHourlyUpdate()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="18" height="18">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
          </svg>
          Copy Update
        </button>
        <span class="hourly-copy-confirm" id="hourlyCopyConfirm"> Copied!</span>
      </div>
      <div class="hourly-update-grid">
        <div class="hourly-stat">
          <span class="hourly-label">Total Inducted</span>
          <span class="hourly-value" id="hourlyTotalInducted">0</span>
        </div>
        <div class="hourly-stat">
          <span class="hourly-label">Left to Induct</span>
          <span class="hourly-value orange" id="hourlyLeftInduct">0</span>
        </div>
        <div class="hourly-stat">
          <span class="hourly-label">Total Stowed</span>
          <span class="hourly-value" id="hourlyTotalStowed">0</span>
        </div>
        <div class="hourly-stat">
          <span class="hourly-label">Left to Stow</span>
          <span class="hourly-value orange" id="hourlyLeftStow">0</span>
        </div>
        <div class="hourly-stat">
          <span class="hourly-label">Time Left</span>
          <span class="hourly-value" id="hourlyTimeLeft">0:00</span>
        </div>
        <div class="hourly-stat highlight">
          <span class="hourly-label">Req Flow to Finish</span>
          <span class="hourly-value" id="hourlyReqFlow">0</span>
          <span class="hourly-sub">TPH</span>
        </div>
      </div>
      <!-- 9 AM Finish Row -->
      <div class="hourly-9am-row">
        <div class="nine-am-stat">
          <span class="nine-am-label"> Time to 9:00 AM:</span>
          <span class="nine-am-value" id="timeTo9am">0:00</span>
        </div>
        <div class="nine-am-stat highlight-9am">
          <span class="nine-am-label"> Required Stow Flow by 9 AM:</span>
          <span class="nine-am-value" id="reqFlowBy9am">0</span>
          <span class="nine-am-sub">TPH</span>
        </div>
      </div>
    </div>

    <!-- Staffing Results Section -->
    <div class="staffing-section">
      <!-- Cycle 1 Dock -->
      <div class="staffing-card">
        <div class="staffing-card-header">
          <h3 class="staffing-card-title">Cycle 1 Dock</h3>
        </div>
        <div class="staffing-card-body">
          <table class="staffing-table">
            <thead>
              <tr>
                <th>Role</th>
                <th style="text-align: center;">Planned HC</th>
                <th style="text-align: center;">Actual HC</th>
                <th>A. PPH</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="role-name">Waterspider</td>
                <td class="staff-count" id="c1WaterspiderPlan">0</td>
                <td><input type="number" class="actual-input" id="c1WaterspiderActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1WaterspiderPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Lineloader</td>
                <td class="staff-count" id="c1LineloaderPlan">0</td>
                <td><input type="number" class="actual-input" id="c1LineloaderActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1LineloaderPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Inducters</td>
                <td class="staff-count" id="c1InductersPlan">0</td>
                <td><input type="number" class="actual-input" id="c1InductersActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1InductersPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Pushers</td>
                <td class="staff-count" id="c1PushersPlan">0</td>
                <td><input type="number" class="actual-input" id="c1PushersActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1PushersPPH">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="staffing-total">
          <span class="staffing-total-label">Total C1 Dock</span>
          <span class="staffing-total-value" id="c1DockTotal">0</span>
        </div>
      </div>

      <!-- Cycle 1 Sort -->
      <div class="staffing-card">
        <div class="staffing-card-header">
          <h3 class="staffing-card-title">Cycle 1 Sort (P2B by Cluster)</h3>
        </div>
        <div class="staffing-card-body">
          <table class="staffing-table">
            <thead>
              <tr>
                <th>Role</th>
                <th style="text-align: center;">Planned HC</th>
                <th style="text-align: center;">Actual HC</th>
                <th>A. PPH</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="role-name">Diverter</td>
                <td class="staff-count" id="c1DiverterPlan">0</td>
                <td><input type="number" class="actual-input" id="c1DiverterActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1DiverterPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">P2B - A</td>
                <td class="staff-count" id="c1P2BAPlan">0</td>
                <td><input type="number" class="actual-input" id="c1P2BAActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1P2BAPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">P2B - B</td>
                <td class="staff-count" id="c1P2BBPlan">0</td>
                <td><input type="number" class="actual-input" id="c1P2BBActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1P2BBPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">P2B - C</td>
                <td class="staff-count" id="c1P2BCPlan">0</td>
                <td><input type="number" class="actual-input" id="c1P2BCActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1P2BCPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">P2B - D</td>
                <td class="staff-count" id="c1P2BDPlan">0</td>
                <td><input type="number" class="actual-input" id="c1P2BDActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1P2BDPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">P2B - E</td>
                <td class="staff-count" id="c1P2BEPlan">0</td>
                <td><input type="number" class="actual-input" id="c1P2BEActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1P2BEPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">P2B - G</td>
                <td class="staff-count" id="c1P2BGPlan">0</td>
                <td><input type="number" class="actual-input" id="c1P2BGActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="c1P2BGPPH">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="staffing-total">
          <span class="staffing-total-label">Total C1 Sort</span>
          <span class="staffing-total-value" id="c1SortTotal">0</span>
        </div>
      </div>

      <!-- Same Day Operations -->
      <div class="staffing-card">
        <div class="staffing-card-header">
          <h3 class="staffing-card-title">Same Day (SSD) Operations</h3>
        </div>
        <div class="staffing-card-body">
          <table class="staffing-table">
            <thead>
              <tr>
                <th>Role</th>
                <th style="text-align: center;">Planned HC</th>
                <th style="text-align: center;">Actual HC</th>
                <th>A. PPH</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="role-name">SSD Waterspider</td>
                <td class="staff-count" id="ssdWaterspiderPlan">0</td>
                <td><input type="number" class="actual-input" id="ssdWaterspiderActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="ssdWaterspiderPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">SSD Lineloader</td>
                <td class="staff-count" id="ssdLineloaderPlan">0</td>
                <td><input type="number" class="actual-input" id="ssdLineloaderActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="ssdLineloaderPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">SSD Inducters</td>
                <td class="staff-count" id="ssdInductersPlan">0</td>
                <td><input type="number" class="actual-input" id="ssdInductersActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="ssdInductersPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">SSD Pushers</td>
                <td class="staff-count" id="ssdPushersPlan">0</td>
                <td><input type="number" class="actual-input" id="ssdPushersActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="ssdPushersPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">SSD P2B</td>
                <td class="staff-count" id="ssdP2BPlan">0</td>
                <td><input type="number" class="actual-input" id="ssdP2BActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="ssdP2BPPH">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="staffing-total">
          <span class="staffing-total-label">Total SSD</span>
          <span class="staffing-total-value" id="ssdTotal">0</span>
        </div>
      </div>

      <!-- Other Indirects -->
      <div class="staffing-card">
        <div class="staffing-card-header">
          <h3 class="staffing-card-title">Other Indirects</h3>
        </div>
        <div class="staffing-card-body">
          <table class="staffing-table">
            <thead>
              <tr>
                <th>Role</th>
                <th style="text-align: center;">Actual HC</th>
                <th>A. PPH</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="role-name">Problem Solve</td>
                <td><input type="number" class="actual-input" id="problemSolveActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="problemSolvePPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Hazmat</td>
                <td><input type="number" class="actual-input" id="hazmatActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="hazmatPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Yard Assist</td>
                <td><input type="number" class="actual-input" id="yardAssistActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="yardAssistPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Process Assistant</td>
                <td><input type="number" class="actual-input" id="paActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="paPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">Safety</td>
                <td><input type="number" class="actual-input" id="safetyActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="safetyPPH">0</td>
              </tr>
              <tr>
                <td class="role-name">5S</td>
                <td><input type="number" class="actual-input" id="fiveSActual" placeholder="0" oninput="calculateActualPPH()"></td>
                <td class="pph-value" id="fiveSPPH">0</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="staffing-total">
          <span class="staffing-total-label">Total Indirects</span>
          <span class="staffing-total-value" id="indirectsTotal">0</span>
        </div>
      </div>
    </div>

    <!-- PPH Reference -->
    <section class="card pph-reference">
      <div class="section-header">
        <h2 class="section-title">Sort Path PPH Reference</h2>
      </div>
      <div class="pph-grid">
        <div class="pph-item">
          <span class="pph-role">Container Building</span>
          <span class="pph-value-display">180</span>
        </div>
        <div class="pph-item">
          <span class="pph-role">Pick To Buffer</span>
          <span class="pph-value-display">400</span>
        </div>
        <div class="pph-item">
          <span class="pph-role">Induct</span>
          <span class="pph-value-display">1,064</span>
        </div>
        <div class="pph-item">
          <span class="pph-role">Waterspider</span>
          <span class="pph-value-display">1,685</span>
        </div>
        <div class="pph-item">
          <span class="pph-role">Pusher</span>
          <span class="pph-value-display">1,382</span>
        </div>
        <div class="pph-item">
          <span class="pph-role">Diverter</span>
          <span class="pph-value-display">4,480</span>
        </div>
        <div class="pph-item">
          <span class="pph-role">Line Loader</span>
          <span class="pph-value-display">1,368</span>
        </div>
      </div>
    </section>
  </div>

  <!-- Hourly Report Modal -->
  <div class="modal-overlay" id="reportModal">
    <div class="modal report-modal">
      <div class="modal-header" style="background: linear-gradient(135deg, var(--purple) 0%, #7C3AED 100%);">
        <h2 class="modal-title">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="32" height="32">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          Hourly Update Report
        </h2>
        <button class="modal-close" onclick="closeReportModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="report-preview" id="reportPreview">
          <!-- Report content will be generated here -->
        </div>
        <div class="report-actions">
          <button class="btn btn-copy" onclick="copyReport()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            Copy to Clipboard
          </button>
          <span class="copy-confirm" id="copyConfirm"> Copied!</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Voice Feedback Toast -->
  <div class="voice-toast" id="voiceToast">
    <span class="voice-toast-icon"></span>
    <div class="voice-toast-text">
      <span id="voiceHeard"></span>
      <span class="action" id="voiceAction"></span>
    </div>
  </div>

  <!-- Break Modal -->
  <div class="modal-overlay" id="breakModal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="32" height="32">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          Break Status Report
        </h2>
        <button class="modal-close" onclick="closeBreakModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="break-stats-grid">
          <div class="break-stat-card">
            <div class="break-stat-label">Remaining to Induct</div>
            <div class="break-stat-value orange" id="modalRemainingInduct">0</div>
            <div class="break-stat-unit">units</div>
          </div>
          <div class="break-stat-card">
            <div class="break-stat-label">Remaining to Stow</div>
            <div class="break-stat-value teal" id="modalRemainingStow">0</div>
            <div class="break-stat-unit">units</div>
          </div>
          <div class="break-stat-card">
            <div class="break-stat-label">Inducted So Far</div>
            <div class="break-stat-value" id="modalInductedSoFar">0</div>
            <div class="break-stat-unit">units</div>
          </div>
          <div class="break-stat-card">
            <div class="break-stat-label">Stowed So Far</div>
            <div class="break-stat-value" id="modalStowedSoFar">0</div>
            <div class="break-stat-unit">units</div>
          </div>
        </div>

        <div class="flow-required-section">
          <div class="flow-required-title"> Flow Required to Finish On Time</div>
          <div class="flow-required-grid">
            <div class="flow-required-item">
              <div class="flow-required-label">Required Induct Flow (TPH)</div>
              <div class="flow-required-value" id="modalInductFlow">0</div>
            </div>
            <div class="flow-required-item">
              <div class="flow-required-label">Required Stow Flow (TPH)</div>
              <div class="flow-required-value" id="modalStowFlow">0</div>
            </div>
            <div class="flow-required-item">
              <div class="flow-required-label">Target Finish Time</div>
              <div class="flow-required-value" id="modalTargetTime">--:--</div>
            </div>
            <div class="flow-required-item">
              <div class="flow-required-label">Time Remaining</div>
              <div class="flow-required-value" id="modalTimeRemaining">0:00</div>
            </div>
          </div>
          <div class="time-remaining">
            <div class="time-remaining-label">Status</div>
            <div class="time-remaining-value" id="modalStatus">Enter data to calculate</div>
          </div>
        </div>
        
        <!-- Copy Button for Break Status -->
        <div class="break-copy-section">
          <button class="btn btn-copy-break" onclick="copyBreakStatus()">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
            </svg>
            Copy Break Status
          </button>
          <span class="break-copy-confirm" id="breakCopyConfirm"> Copied!</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // PPH Constants - defaults, will be overridden by Sort Wash weekly rates if available
    let PPH = {
      containerBuilding: 180,
      pickToBuffer: 400,
      induct: 1064,
      waterspider: 1685,
      pusher: 1382,
      diverter: 4480,
      lineLoader: 1368
    };

    // Load weekly rates from Sort Wash (if saved)
    function loadWeeklyRates() {
      const now = new Date();
      const startOfWeek = new Date(now);
      startOfWeek.setDate(now.getDate() - now.getDay());
      const weekKey = 'sortWash_planned_' + startOfWeek.toISOString().split('T')[0];

      const savedData = localStorage.getItem(weekKey);
      if (savedData) {
        const planned = JSON.parse(savedData);
        
        // Update PPH values from Sort Wash planned rates
        if (planned.containerPlanned && parseFloat(planned.containerPlanned) > 0) PPH.containerBuilding = parseFloat(planned.containerPlanned);
        if (planned.p2bPlanned && parseFloat(planned.p2bPlanned) > 0) PPH.pickToBuffer = parseFloat(planned.p2bPlanned);
        if (planned.inductPlanned && parseFloat(planned.inductPlanned) > 0) PPH.induct = parseFloat(planned.inductPlanned);
        if (planned.wsPlanned && parseFloat(planned.wsPlanned) > 0) PPH.waterspider = parseFloat(planned.wsPlanned);
        if (planned.pusherPlanned && parseFloat(planned.pusherPlanned) > 0) PPH.pusher = parseFloat(planned.pusherPlanned);
        if (planned.diverterPlanned && parseFloat(planned.diverterPlanned) > 0) PPH.diverter = parseFloat(planned.diverterPlanned);
        if (planned.lineloaderPlanned && parseFloat(planned.lineloaderPlanned) > 0) PPH.lineLoader = parseFloat(planned.lineloaderPlanned);

        // Update the PPH reference display
        updatePPHDisplay();
        
        // Show indicator that custom rates are loaded
        showRatesLoaded();
        
        console.log('Loaded weekly rates from Sort Wash:', PPH);
        return true;
      }
      return false;
    }

    // Update PPH Reference display to show current rates
    function updatePPHDisplay() {
      const pphItems = document.querySelectorAll('.pph-item');
      const labels = {
        'Container Building': PPH.containerBuilding,
        'Pick To Buffer': PPH.pickToBuffer,
        'Induct': PPH.induct,
        'Waterspider': PPH.waterspider,
        'Pusher': PPH.pusher,
        'Diverter': PPH.diverter,
        'Line Loader': PPH.lineLoader
      };

      pphItems.forEach(item => {
        const roleEl = item.querySelector('.pph-role');
        const valueEl = item.querySelector('.pph-value-display');
        if (roleEl && valueEl) {
          const role = roleEl.textContent;
          if (labels[role] !== undefined) {
            valueEl.textContent = Math.round(labels[role]).toLocaleString();
          }
        }
      });
    }

    // Show indicator that Sort Wash rates are loaded
    function showRatesLoaded() {
      const refSection = document.querySelector('.pph-reference .section-header .section-title');
      if (refSection && !refSection.querySelector('.rates-badge')) {
        const badge = document.createElement('span');
        badge.className = 'rates-badge';
        badge.innerHTML = ' Using Sort Wash Rates';
        badge.style.cssText = 'background: rgba(63, 185, 80, 0.2); color: var(--success); font-size: 0.75rem; padding: 0.25rem 0.75rem; border-radius: 20px; margin-left: 1rem; font-family: Barlow, sans-serif; text-transform: none; letter-spacing: normal;';
        refSection.appendChild(badge);
      }
      
      // Update summary panel indicator
      const ratesSource = document.getElementById('ratesSource');
      if (ratesSource) {
        ratesSource.textContent = ' Using Sort Wash Rates';
        ratesSource.classList.add('custom');
      }
    }

    // Update current time
    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').textContent = now.toLocaleTimeString('en-US', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit',
        hour12: true 
      });
      document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
    }
    setInterval(updateTime, 1000);
    updateTime();

    // Calculate Belt Run Time
    function calculateRunTime() {
      const startTime = document.getElementById('shiftStart').value;
      const endTime = document.getElementById('shiftEnd').value;
      const earlyEnd = document.getElementById('earlyEnd').value;
      
      let start = timeToMinutes(startTime);
      let end = timeToMinutes(earlyEnd || endTime);
      
      // Handle overnight shift (if end is less than start, add 24 hours)
      if (end < start) {
        end += 24 * 60;
      }
      
      let totalMinutes = end - start;
      
      // Deduct breaks
      if (document.getElementById('break1').checked) totalMinutes -= 15;
      if (document.getElementById('lunch').checked) totalMinutes -= 30;
      if (document.getElementById('break2').checked) totalMinutes -= 15;
      totalMinutes -= parseInt(document.getElementById('customBreak').value) || 0;
      
      const hours = Math.floor(totalMinutes / 60);
      const minutes = totalMinutes % 60;
      
      document.getElementById('totalRunTime').textContent = `${hours}:${minutes.toString().padStart(2, '0')}`;
      
      updateStats();
    }

    function timeToMinutes(timeStr) {
      if (!timeStr) return 0;
      const [hours, minutes] = timeStr.split(':').map(Number);
      return hours * 60 + minutes;
    }

    // Reset to default shift times
    function resetToDefault() {
      document.getElementById('shiftStart').value = '01:20';
      document.getElementById('shiftEnd').value = '08:30';
      document.getElementById('earlyEnd').value = '';
      document.getElementById('break1').checked = true;
      document.getElementById('lunch').checked = true;
      document.getElementById('break2').checked = true;
      document.getElementById('customBreak').value = 0;
      calculateRunTime();
    }

    // Update all statistics
    function updateStats() {
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      
      // Update BOTH volume displays
      document.getElementById('statTotalVolume').textContent = totalVolume.toLocaleString();
      document.getElementById('summaryVolume').textContent = totalVolume.toLocaleString();
      
      // Calculate required TPH
      const runTimeText = document.getElementById('totalRunTime').textContent;
      const [hours, mins] = runTimeText.split(':').map(Number);
      const runTimeHours = hours + (mins / 60);
      
      const requiredTPH = runTimeHours > 0 ? Math.round(totalVolume / runTimeHours) : 0;
      document.getElementById('statRequiredTPH').textContent = requiredTPH.toLocaleString();
      
      // Calculate staffing based on volume and run time
      calculateStaffing(totalVolume);
      updateProgress();
    }

    // Update progress tracking
    function updateProgress() {
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      const inductedSoFar = parseInt(document.getElementById('inductedSoFar').value) || 0;
      const stowedSoFar = parseInt(document.getElementById('stowedSoFar').value) || 0;
      
      // If induct is complete, use inducted amount as total
      const effectiveTotal = inductCompleteData ? inductCompleteData.finalInducted : totalVolume;
      
      const remainingInduct = inductCompleteData ? 0 : Math.max(0, totalVolume - inductedSoFar);
      const remainingStow = Math.max(0, effectiveTotal - stowedSoFar);
      
      document.getElementById('remainingInduct').value = remainingInduct;
      document.getElementById('remainingStow').value = remainingStow;
      document.getElementById('statRemainingVol').textContent = remainingInduct.toLocaleString();
      
      // Update hourly display with calculated values
      if (inductCompleteData) {
        // Recalculate final stow data
        updateFinalStowDisplay();
        updateHourlyDisplayAfterInductComplete();
      } else {
        updateHourlyDisplay(inductedSoFar, stowedSoFar, remainingInduct, remainingStow);
      }
    }

    // ==================== INDUCT COMPLETE ====================
    let inductCompleteData = null;

    function markInductComplete() {
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      const inductedSoFar = parseInt(document.getElementById('inductedSoFar').value) || 0;
      const stowedSoFar = parseInt(document.getElementById('stowedSoFar').value) || 0;
      
      if (inductedSoFar === 0) {
        alert('Please enter the final inducted amount first.');
        return;
      }
      
      // Calculate crashed/rolled (what didn't get inducted)
      const crashedRolled = Math.max(0, totalVolume - inductedSoFar);
      
      // Final left to stow = inducted - already stowed
      const finalLeftToStow = Math.max(0, inductedSoFar - stowedSoFar);
      
      // Calculate time to 9 AM
      const now = new Date();
      const currentHour = now.getHours();
      let nineAMTime = new Date(now);
      nineAMTime.setHours(9, 0, 0, 0);
      
      if (currentHour >= 12) {
        nineAMTime.setDate(nineAMTime.getDate() + 1);
      } else if (nineAMTime <= now) {
        nineAMTime.setDate(nineAMTime.getDate() + 1);
      }
      
      let hoursTo9am = (nineAMTime - now) / (1000 * 60 * 60);
      if (hoursTo9am > 12) hoursTo9am = 12;
      if (hoursTo9am < 0) hoursTo9am = 0;
      
      const hrs9am = Math.floor(hoursTo9am);
      const mins9am = Math.floor((hoursTo9am % 1) * 60);
      const timeTo9amStr = `${hrs9am}:${String(mins9am).padStart(2, '0')}`;
      
      // Calculate final required flow
      const finalStowFlow = hoursTo9am > 0 ? Math.round(finalLeftToStow / hoursTo9am) : 0;
      
      // Save data
      inductCompleteData = {
        finalInducted: inductedSoFar,
        alreadyStowed: stowedSoFar,
        leftToStow: finalLeftToStow,
        crashedRolled: crashedRolled,
        timeTo9am: timeTo9amStr,
        hoursTo9am: hoursTo9am,
        finalStowFlow: finalStowFlow,
        timestamp: now.toISOString()
      };
      
      // Update display
      updateFinalStowDisplay();
      
      // Show panel
      document.getElementById('finalStowPanel').style.display = 'block';
      
      // Update button
      const btn = document.getElementById('inductCompleteBtn');
      btn.classList.add('completed');
      btn.innerHTML = `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg> INDUCT MARKED COMPLETE`;
      
      // Scroll to panel
      document.getElementById('finalStowPanel').scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      // Update remaining stow to be based on inducted (not planned volume)
      document.getElementById('remainingStow').value = finalLeftToStow;
      
      // Update hourly display
      updateHourlyDisplayAfterInductComplete();
    }

    function updateFinalStowDisplay() {
      if (!inductCompleteData) return;
      
      // Recalculate based on current stowed
      const stowedSoFar = parseInt(document.getElementById('stowedSoFar').value) || 0;
      const finalLeftToStow = Math.max(0, inductCompleteData.finalInducted - stowedSoFar);
      
      // Recalculate time to 9 AM
      const now = new Date();
      const currentHour = now.getHours();
      let nineAMTime = new Date(now);
      nineAMTime.setHours(9, 0, 0, 0);
      
      if (currentHour >= 12) {
        nineAMTime.setDate(nineAMTime.getDate() + 1);
      } else if (nineAMTime <= now) {
        nineAMTime.setDate(nineAMTime.getDate() + 1);
      }
      
      let hoursTo9am = (nineAMTime - now) / (1000 * 60 * 60);
      if (hoursTo9am > 12) hoursTo9am = 12;
      if (hoursTo9am < 0) hoursTo9am = 0;
      
      const hrs9am = Math.floor(hoursTo9am);
      const mins9am = Math.floor((hoursTo9am % 1) * 60);
      const timeTo9amStr = `${hrs9am}:${String(mins9am).padStart(2, '0')}`;
      
      const finalStowFlow = hoursTo9am > 0 ? Math.round(finalLeftToStow / hoursTo9am) : 0;
      
      // Update saved data
      inductCompleteData.alreadyStowed = stowedSoFar;
      inductCompleteData.leftToStow = finalLeftToStow;
      inductCompleteData.timeTo9am = timeTo9amStr;
      inductCompleteData.hoursTo9am = hoursTo9am;
      inductCompleteData.finalStowFlow = finalStowFlow;
      
      // Update timestamp display
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      document.getElementById('finalTimeStamp').textContent = timeStr;
      
      // Update display
      document.getElementById('finalInducted').textContent = inductCompleteData.finalInducted.toLocaleString();
      document.getElementById('finalAlreadyStowed').textContent = stowedSoFar.toLocaleString();
      document.getElementById('finalLeftToStow').textContent = finalLeftToStow.toLocaleString();
      document.getElementById('finalCrashedRolled').textContent = inductCompleteData.crashedRolled.toLocaleString();
      document.getElementById('finalTimeTo9am').textContent = timeTo9amStr;
      document.getElementById('finalStowFlow').textContent = finalStowFlow.toLocaleString();
    }

    function updateHourlyDisplayAfterInductComplete() {
      if (!inductCompleteData) return;
      
      // Update the hourly display to show actual values
      document.getElementById('hourlyLeftInduct').textContent = '0';
      document.getElementById('hourlyLeftStow').textContent = inductCompleteData.leftToStow.toLocaleString();
      document.getElementById('hourlyReqFlow').textContent = inductCompleteData.finalStowFlow.toLocaleString();
    }

    function undoInductComplete() {
      inductCompleteData = null;
      
      // Hide panel
      document.getElementById('finalStowPanel').style.display = 'none';
      
      // Reset button
      const btn = document.getElementById('inductCompleteBtn');
      btn.classList.remove('completed');
      btn.innerHTML = `<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg> INDUCT COMPLETE`;
      
      // Recalculate progress based on total volume
      updateProgress();
    }

    function copyFinalStowPlan() {
      if (!inductCompleteData) return;
      
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      
      const output = ` INDUCT COMPLETE - ${timeStr}

 Final Inducted: ${inductCompleteData.finalInducted.toLocaleString()}
 Already Stowed: ${inductCompleteData.alreadyStowed.toLocaleString()}
 Left to Stow: ${inductCompleteData.leftToStow.toLocaleString()}
 Crashed/Rolled: ${inductCompleteData.crashedRolled.toLocaleString()}

 Time to 9 AM: ${inductCompleteData.timeTo9am}
 Required Stow Flow: ${inductCompleteData.finalStowFlow.toLocaleString()} TPH`;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(output).then(() => {
          showFinalCopyConfirm();
        });
      } else {
        const textarea = document.createElement('textarea');
        textarea.value = output;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        showFinalCopyConfirm();
      }
    }

    function showFinalCopyConfirm() {
      const confirm = document.getElementById('finalCopyConfirm');
      confirm.classList.add('show');
      setTimeout(() => confirm.classList.remove('show'), 2000);
    }

    // Update when user directly enters Remaining values
    function updateFromRemaining() {
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      const remainingInduct = parseInt(document.getElementById('remainingInduct').value.replace(/,/g, '')) || 0;
      const remainingStow = parseInt(document.getElementById('remainingStow').value.replace(/,/g, '')) || 0;
      
      // Calculate inducted/stowed so far based on remaining
      const inductedSoFar = Math.max(0, totalVolume - remainingInduct);
      const stowedSoFar = Math.max(0, totalVolume - remainingStow);
      
      document.getElementById('inductedSoFar').value = inductedSoFar;
      document.getElementById('stowedSoFar').value = stowedSoFar;
      document.getElementById('statRemainingVol').textContent = remainingInduct.toLocaleString();
      
      // Update hourly display with calculated values
      updateHourlyDisplay(inductedSoFar, stowedSoFar, remainingInduct, remainingStow);
    }

    // Update hourly display section
    function updateHourlyDisplay(inductedSoFar, stowedSoFar, remainingInduct, remainingStow) {
      // If called without params, get values from DOM
      if (inductedSoFar === undefined) {
        const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
        inductedSoFar = parseInt(document.getElementById('inductedSoFar').value) || 0;
        stowedSoFar = parseInt(document.getElementById('stowedSoFar').value) || 0;
        remainingInduct = Math.max(0, totalVolume - inductedSoFar);
        remainingStow = Math.max(0, totalVolume - stowedSoFar);
      }
      
      const now = new Date();
      const currentHour = now.getHours();
      
      // ===== TARGET FINISH TIME CALCULATION =====
      const targetFinish = document.getElementById('targetFinishTime').value || '08:00';
      const [finishHour, finishMin] = targetFinish.split(':').map(Number);
      
      let finishTime = new Date(now);
      finishTime.setHours(finishHour, finishMin, 0, 0);
      
      // Smart overnight detection for target
      if (finishHour < 12) {
        if (currentHour >= 12) {
          finishTime.setDate(finishTime.getDate() + 1);
        } else if (finishTime <= now) {
          finishTime.setDate(finishTime.getDate() + 1);
        }
      }
      
      let msRemaining = finishTime - now;
      let hoursRemaining = msRemaining / (1000 * 60 * 60);
      
      // Cap at 12 hours max
      if (hoursRemaining > 12) hoursRemaining = 12;
      if (hoursRemaining < 0) hoursRemaining = 0;
      
      const hrs = Math.floor(hoursRemaining);
      const mins = Math.floor((hoursRemaining % 1) * 60);
      const timeLeftStr = `${hrs}:${String(mins).padStart(2, '0')}`;
      
      // Calculate required flow to finish on time
      const requiredFlow = hoursRemaining > 0 ? Math.round(remainingStow / hoursRemaining) : 0;
      
      // ===== 9 AM CALCULATION =====
      let nineAMTime = new Date(now);
      nineAMTime.setHours(9, 0, 0, 0);
      
      // If 9 AM already passed today (and it's AM), use tomorrow's 9 AM
      // If it's PM, 9 AM is tomorrow
      if (currentHour >= 12) {
        nineAMTime.setDate(nineAMTime.getDate() + 1);
      } else if (nineAMTime <= now) {
        nineAMTime.setDate(nineAMTime.getDate() + 1);
      }
      
      let msTo9am = nineAMTime - now;
      let hoursTo9am = msTo9am / (1000 * 60 * 60);
      
      // Cap at 12 hours max
      if (hoursTo9am > 12) hoursTo9am = 12;
      if (hoursTo9am < 0) hoursTo9am = 0;
      
      const hrs9am = Math.floor(hoursTo9am);
      const mins9am = Math.floor((hoursTo9am % 1) * 60);
      const timeTo9amStr = `${hrs9am}:${String(mins9am).padStart(2, '0')}`;
      
      // Calculate required flow to finish by 9 AM
      const reqFlowBy9am = hoursTo9am > 0 ? Math.round(remainingStow / hoursTo9am) : 0;
      
      // Update display - Target Time
      document.getElementById('hourlyTotalInducted').textContent = inductedSoFar.toLocaleString();
      document.getElementById('hourlyLeftInduct').textContent = remainingInduct.toLocaleString();
      document.getElementById('hourlyTotalStowed').textContent = stowedSoFar.toLocaleString();
      document.getElementById('hourlyLeftStow').textContent = remainingStow.toLocaleString();
      document.getElementById('hourlyTimeLeft').textContent = timeLeftStr;
      document.getElementById('hourlyReqFlow').textContent = requiredFlow.toLocaleString();
      
      // Update display - 9 AM
      document.getElementById('timeTo9am').textContent = timeTo9amStr;
      document.getElementById('reqFlowBy9am').textContent = reqFlowBy9am.toLocaleString();
    }

    // Copy hourly update to clipboard
    function copyHourlyUpdate() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      
      const totalInducted = document.getElementById('hourlyTotalInducted').textContent;
      const leftInduct = document.getElementById('hourlyLeftInduct').textContent;
      const totalStowed = document.getElementById('hourlyTotalStowed').textContent;
      const timeLeft = document.getElementById('hourlyTimeLeft').textContent;
      const targetFinish = document.getElementById('targetFinishTime').value || '08:00';
      
      // Format target finish for display
      const [h, m] = targetFinish.split(':').map(Number);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const h12 = h % 12 || 12;
      const targetFinishStr = `${h12}:${String(m).padStart(2, '0')} ${ampm}`;
      
      let output;
      
      // Check if induct is complete
      if (inductCompleteData) {
        // Use actual inducted volume for calculations
        const actualLeftToStow = inductCompleteData.leftToStow;
        const finalStowFlow = inductCompleteData.finalStowFlow;
        
        output = ` HOURLY UPDATE - ${timeStr}
 INDUCT COMPLETE

 Final Inducted: ${inductCompleteData.finalInducted.toLocaleString()}
 Total Stowed: ${totalStowed}
 Left to Stow: ${actualLeftToStow.toLocaleString()}
 Crashed/Rolled: ${inductCompleteData.crashedRolled.toLocaleString()}

 Target Finish: ${targetFinishStr}
 Time Left: ${timeLeft}
 Required Flow to Finish: ${finalStowFlow.toLocaleString()} TPH`;
      } else {
        // Normal hourly update
        const leftStow = document.getElementById('hourlyLeftStow').textContent;
        const requiredFlow = document.getElementById('hourlyReqFlow').textContent;
        
        output = ` HOURLY UPDATE - ${timeStr}

 Total Inducted: ${totalInducted}
 Left to Induct: ${leftInduct}
 Total Stowed: ${totalStowed}
 Left to Stow: ${leftStow}

 Target Finish: ${targetFinishStr}
 Time Left: ${timeLeft}
 Required Flow to Finish: ${requiredFlow} TPH`;
      }

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(output).then(() => {
          showHourlyCopyConfirm();
        }).catch(() => {
          fallbackHourlyCopy(output);
        });
      } else {
        fallbackHourlyCopy(output);
      }
    }

    function fallbackHourlyCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      showHourlyCopyConfirm();
    }

    function showHourlyCopyConfirm() {
      const confirm = document.getElementById('hourlyCopyConfirm');
      confirm.classList.add('show');
      setTimeout(() => confirm.classList.remove('show'), 2000);
    }

    // Calculate staffing requirements
    function calculateStaffing(totalVolume) {
      // Get run time in hours
      const runTimeText = document.getElementById('totalRunTime').textContent;
      const [hours, mins] = runTimeText.split(':').map(Number);
      const runTimeHours = hours + (mins / 60);
      
      if (runTimeHours <= 0 || totalVolume <= 0) {
        // Reset all planned values to 0
        document.getElementById('c1WaterspiderPlan').textContent = '0';
        document.getElementById('c1LineloaderPlan').textContent = '0';
        document.getElementById('c1InductersPlan').textContent = '0';
        document.getElementById('c1PushersPlan').textContent = '0';
        document.getElementById('c1DockTotal').textContent = '0';
        document.getElementById('c1DiverterPlan').textContent = '0';
        document.getElementById('c1P2BAPlan').textContent = '0';
        document.getElementById('c1P2BBPlan').textContent = '0';
        document.getElementById('c1P2BCPlan').textContent = '0';
        document.getElementById('c1P2BDPlan').textContent = '0';
        document.getElementById('c1P2BEPlan').textContent = '0';
        document.getElementById('c1P2BGPlan').textContent = '0';
        document.getElementById('c1SortTotal').textContent = '0';
        document.getElementById('statTotalStaff').textContent = '0';
        return;
      }
      
      // ===== PRE-SHIFT FORMULA FOR TOTAL HC =====
      // Planned HC = [(Volume  TPH)  Indirect Factor]  Hours per AA
      const targetTPH = 90;  // Site's planning rate
      const indirectFactor = 1.17;  // 17% overhead
      const hoursPerAA = 7.2;  // Paid hours per person
      
      const directHours = totalVolume / targetTPH;
      const plannedHours = directHours * indirectFactor;
      const totalHC = Math.ceil(plannedHours / hoursPerAA);
      
      // Calculate hourly rate needed (for display and role breakdown)
      const hourlyRate = totalVolume / runTimeHours;
      
      // ===== SPLIT HC BETWEEN DOCK AND SORT =====
      // Use ratio based on typical split (approximately 40% Dock, 60% Sort)
      // Or calculate based on role requirements
      
      // Calculate individual role needs for ratio purposes
      const c1Waterspider = (hourlyRate / PPH.waterspider).toFixed(1);
      const c1Lineloader = (hourlyRate / PPH.lineLoader).toFixed(1);
      const c1Inducters = (hourlyRate / PPH.induct).toFixed(1);
      const c1Pushers = (hourlyRate / PPH.pusher).toFixed(1);
      const diverter = (hourlyRate / PPH.diverter).toFixed(1);
      
      // Dock roles total (for ratio calculation)
      const dockRolesRaw = parseFloat(c1Waterspider) + parseFloat(c1Lineloader) + 
                          parseFloat(c1Inducters) + parseFloat(c1Pushers) + 
                          Math.max(2, parseFloat(diverter));
      
      // Get stow rate and efficiency for sort calculation
      const stowRatePPH = parseFloat(document.getElementById('stowRatePPH').value) || 260;
      const efficiencyPercent = parseFloat(document.getElementById('efficiencyPercent').value) || 85;
      const efficiency = efficiencyPercent / 100;
      const effectiveStowPPH = stowRatePPH * efficiency;
      document.getElementById('effectiveStowPPH').textContent = Math.round(effectiveStowPPH);
      
      const requiredStowFlow = hourlyRate;
      
      // ===== STOWERS NEEDED - DIRECTLY FROM STOW RATE =====
      // Stowers = Required Flow / Effective Stow PPH
      const stowersNeeded = Math.ceil(requiredStowFlow / effectiveStowPPH);
      
      // Dock HC = Total HC from Pre-Shift formula minus Stowers
      // Or calculate Dock roles separately
      const dockHC = Math.ceil(dockRolesRaw);
      const sortHC = stowersNeeded;
      
      // Recalculate Total HC = Dock + Stowers
      const totalHCActual = dockHC + sortHC;
      
      // Display individual dock role calculations (for reference)
      document.getElementById('c1WaterspiderPlan').textContent = c1Waterspider;
      document.getElementById('c1LineloaderPlan').textContent = c1Lineloader;
      document.getElementById('c1InductersPlan').textContent = c1Inducters;
      document.getElementById('c1PushersPlan').textContent = c1Pushers;
      document.getElementById('c1DockTotal').textContent = dockHC;
      
      // C1 Sort - P2B by cluster
      const clusterValues = {
        A: parseInt(document.getElementById('clusterA').value) || 0,
        B: parseInt(document.getElementById('clusterB').value) || 0,
        C: parseInt(document.getElementById('clusterC').value) || 0,
        D: parseInt(document.getElementById('clusterD').value) || 0,
        E: parseInt(document.getElementById('clusterE').value) || 0,
        G: parseInt(document.getElementById('clusterG').value) || 0
      };
      
      const p2bA = (clusterValues.A / runTimeHours / PPH.pickToBuffer).toFixed(1);
      const p2bB = (clusterValues.B / runTimeHours / PPH.pickToBuffer).toFixed(1);
      const p2bC = (clusterValues.C / runTimeHours / PPH.pickToBuffer).toFixed(1);
      const p2bD = (clusterValues.D / runTimeHours / PPH.pickToBuffer).toFixed(1);
      const p2bE = (clusterValues.E / runTimeHours / PPH.pickToBuffer).toFixed(1);
      const p2bG = (clusterValues.G / runTimeHours / PPH.pickToBuffer).toFixed(1);
      
      document.getElementById('c1DiverterPlan').textContent = Math.max(2, Math.ceil(parseFloat(diverter)));
      document.getElementById('c1P2BAPlan').textContent = p2bA;
      document.getElementById('c1P2BBPlan').textContent = p2bB;
      document.getElementById('c1P2BCPlan').textContent = p2bC;
      document.getElementById('c1P2BDPlan').textContent = p2bD;
      document.getElementById('c1P2BEPlan').textContent = p2bE;
      document.getElementById('c1P2BGPlan').textContent = p2bG;
      
      document.getElementById('c1SortTotal').textContent = sortHC;
      
      // Update old total staff display - use actual calculated
      document.getElementById('statTotalStaff').textContent = totalHCActual;
      
      // ===== UPDATE STAFFING SUMMARY PANEL =====
      document.getElementById('summaryVolume').textContent = totalVolume.toLocaleString();
      document.getElementById('summaryRunTime').textContent = runTimeText + 'h';
      document.getElementById('summaryTPH').textContent = Math.round(hourlyRate).toLocaleString();
      document.getElementById('summaryTotalHC').textContent = totalHCActual;
      
      // Dock side breakdown
      document.getElementById('recWaterspider').textContent = Math.ceil(parseFloat(c1Waterspider));
      document.getElementById('recLineloader').textContent = Math.ceil(parseFloat(c1Lineloader));
      document.getElementById('recInducters').textContent = Math.ceil(parseFloat(c1Inducters));
      document.getElementById('recPushers').textContent = Math.ceil(parseFloat(c1Pushers));
      document.getElementById('recDiverter').textContent = Math.max(2, Math.ceil(parseFloat(diverter)));
      document.getElementById('recInductTotal').textContent = dockHC;
      
      // Sort side breakdown - STOWERS FROM STOW RATE
      document.getElementById('recStowFlow').textContent = Math.round(requiredStowFlow).toLocaleString();
      document.getElementById('recEffectiveRate').textContent = Math.round(effectiveStowPPH);
      document.getElementById('recStowers').textContent = stowersNeeded;
      
      // Also update the Sort Total with stowers count
      document.getElementById('c1SortTotal').textContent = stowersNeeded;
      
      // Total HC breakdown - Use actual Dock + Sort calculation
      document.getElementById('recInductHC').textContent = dockHC;
      document.getElementById('recStowHC').textContent = sortHC;
      document.getElementById('recTotalHC').textContent = totalHCActual;
      
      // ===== SAVE TO LOCALSTORAGE FOR LOAD OUT PLAN =====
      const flowStaffingData = {
        c1Volume: totalVolume,
        totalHC: totalHCActual,
        dockHC: dockHC,
        sortHC: sortHC,
        requiredTPH: Math.round(hourlyRate),
        directHours: Math.round(directHours),
        plannedHours: Math.round(plannedHours),
        timestamp: new Date().toISOString()
      };
      localStorage.setItem('flowStaffingData', JSON.stringify(flowStaffingData));
      
      calculateActualPPH();
    }

    // Calculate actual PPH based on actual headcount
    function calculateActualPPH() {
      const runTimeText = document.getElementById('totalRunTime').textContent;
      const [hours, mins] = runTimeText.split(':').map(Number);
      const runTimeHours = hours + (mins / 60);
      
      // Get total volume
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      
      // C1 Dock actual PPH calculations
      const roles = [
        { id: 'c1Waterspider', pph: PPH.waterspider },
        { id: 'c1Lineloader', pph: PPH.lineLoader },
        { id: 'c1Inducters', pph: PPH.induct },
        { id: 'c1Pushers', pph: PPH.pusher },
        { id: 'c1Diverter', pph: PPH.diverter },
        { id: 'ssdWaterspider', pph: PPH.waterspider },
        { id: 'ssdLineloader', pph: PPH.lineLoader },
        { id: 'ssdInducters', pph: PPH.induct },
        { id: 'ssdPushers', pph: PPH.pusher }
      ];
      
      roles.forEach(role => {
        const actual = parseInt(document.getElementById(`${role.id}Actual`).value) || 0;
        const actualPPH = actual > 0 && runTimeHours > 0 ? Math.round(totalVolume / actual / runTimeHours) : 0;
        document.getElementById(`${role.id}PPH`).textContent = actualPPH.toLocaleString();
      });
      
      // P2B clusters
      const clusters = ['A', 'B', 'C', 'D', 'E', 'G'];
      clusters.forEach(cluster => {
        const actual = parseInt(document.getElementById(`c1P2B${cluster}Actual`).value) || 0;
        const clusterVol = parseInt(document.getElementById(`cluster${cluster}`).value) || 0;
        const actualPPH = actual > 0 && runTimeHours > 0 ? Math.round(clusterVol / actual / runTimeHours) : 0;
        document.getElementById(`c1P2B${cluster}PPH`).textContent = actualPPH.toLocaleString();
      });
      
      // SSD P2B
      const ssdP2BActual = parseInt(document.getElementById('ssdP2BActual').value) || 0;
      const ssdP2BPPH = ssdP2BActual > 0 && runTimeHours > 0 ? Math.round(totalVolume / ssdP2BActual / runTimeHours) : 0;
      document.getElementById('ssdP2BPPH').textContent = ssdP2BPPH.toLocaleString();
      
      // Calculate totals
      updateTotals();
    }

    // Update section totals
    function updateTotals() {
      // SSD total actual
      const ssdActuals = ['ssdWaterspider', 'ssdLineloader', 'ssdInducters', 'ssdPushers', 'ssdP2B'];
      let ssdActualTotal = 0;
      ssdActuals.forEach(id => {
        ssdActualTotal += parseInt(document.getElementById(`${id}Actual`).value) || 0;
      });
      document.getElementById('ssdTotal').textContent = ssdActualTotal;
      
      // Indirects total
      const indirectActuals = ['problemSolve', 'hazmat', 'yardAssist', 'pa', 'safety', 'fiveS'];
      let indirectTotal = 0;
      indirectActuals.forEach(id => {
        indirectTotal += parseInt(document.getElementById(`${id}Actual`).value) || 0;
      });
      document.getElementById('indirectsTotal').textContent = indirectTotal;
    }

    // Break Modal Functions
    function openBreakModal() {
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      const inductedSoFar = parseInt(document.getElementById('inductedSoFar').value) || 0;
      const stowedSoFar = parseInt(document.getElementById('stowedSoFar').value) || 0;
      
      const remainingInduct = Math.max(0, totalVolume - inductedSoFar);
      const remainingStow = Math.max(0, totalVolume - stowedSoFar);
      
      document.getElementById('modalRemainingInduct').textContent = remainingInduct.toLocaleString();
      document.getElementById('modalRemainingStow').textContent = remainingStow.toLocaleString();
      document.getElementById('modalInductedSoFar').textContent = inductedSoFar.toLocaleString();
      document.getElementById('modalStowedSoFar').textContent = stowedSoFar.toLocaleString();
      
      // Calculate time remaining until shift end
      const now = new Date();
      const shiftEnd = document.getElementById('earlyEnd').value || document.getElementById('shiftEnd').value;
      const [endHour, endMin] = shiftEnd.split(':').map(Number);
      
      let endDate = new Date();
      endDate.setHours(endHour, endMin, 0, 0);
      
      // If end time is earlier than current time, it's the next day
      if (endDate < now) {
        endDate.setDate(endDate.getDate() + 1);
      }
      
      const msRemaining = endDate - now;
      const hoursRemaining = msRemaining / (1000 * 60 * 60);
      
      // Calculate remaining break time to deduct based on actual break schedule
      let breakMinsRemaining = 0;
      const currentHour = now.getHours();
      const currentMin = now.getMinutes();
      const currentTimeValue = currentHour + (currentMin / 60);
      
      // 1st Break: 4:00-4:15 AM - if before 4:15, break still counts
      if (currentTimeValue < 4.25 && document.getElementById('break1').checked) breakMinsRemaining += 15;
      // Lunch: 6:00-6:30 AM - if before 6:30, lunch still counts
      if (currentTimeValue < 6.5 && document.getElementById('lunch').checked) breakMinsRemaining += 30;
      // 2nd Break: 8:45-9:00 AM - if before 9:00, break still counts
      if (currentTimeValue < 9 && document.getElementById('break2').checked) breakMinsRemaining += 15;
      
      const effectiveHoursRemaining = Math.max(0, hoursRemaining - (breakMinsRemaining / 60));
      
      // Calculate required flow rates
      const requiredInductFlow = effectiveHoursRemaining > 0 ? Math.round(remainingInduct / effectiveHoursRemaining) : 0;
      const requiredStowFlow = effectiveHoursRemaining > 0 ? Math.round(remainingStow / effectiveHoursRemaining) : 0;
      
      document.getElementById('modalInductFlow').textContent = requiredInductFlow.toLocaleString();
      document.getElementById('modalStowFlow').textContent = requiredStowFlow.toLocaleString();
      
      // Format target time
      const targetTime = new Date();
      targetTime.setHours(endHour, endMin, 0, 0);
      document.getElementById('modalTargetTime').textContent = targetTime.toLocaleTimeString('en-US', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
      });
      
      // Format time remaining
      const hoursLeft = Math.floor(effectiveHoursRemaining);
      const minsLeft = Math.round((effectiveHoursRemaining - hoursLeft) * 60);
      document.getElementById('modalTimeRemaining').textContent = `${hoursLeft}:${minsLeft.toString().padStart(2, '0')}`;
      
      // Status message
      let statusMsg = '';
      let statusColor = '';
      
      if (totalVolume === 0) {
        statusMsg = 'Enter total volume to calculate';
        statusColor = 'var(--text-muted)';
      } else if (remainingInduct === 0 && remainingStow === 0) {
        statusMsg = ' All volume completed!';
        statusColor = 'var(--success)';
      } else if (effectiveHoursRemaining <= 0) {
        statusMsg = ' Shift time has ended';
        statusColor = 'var(--danger)';
      } else {
        const percentComplete = Math.round(((inductedSoFar + stowedSoFar) / (totalVolume * 2)) * 100);
        statusMsg = `${percentComplete}% Complete - On Track`;
        statusColor = percentComplete >= 50 ? 'var(--success)' : 'var(--warning)';
      }
      
      document.getElementById('modalStatus').textContent = statusMsg;
      document.getElementById('modalStatus').style.color = statusColor;
      
      document.getElementById('breakModal').classList.add('active');
    }

    function closeBreakModal() {
      document.getElementById('breakModal').classList.remove('active');
    }

    function copyBreakStatus() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      
      const remainingInduct = document.getElementById('modalRemainingInduct').textContent;
      const remainingStow = document.getElementById('modalRemainingStow').textContent;
      const inductedSoFar = document.getElementById('modalInductedSoFar').textContent;
      const stowedSoFar = document.getElementById('modalStowedSoFar').textContent;
      const inductFlow = document.getElementById('modalInductFlow').textContent;
      const stowFlow = document.getElementById('modalStowFlow').textContent;
      const targetTime = document.getElementById('modalTargetTime').textContent;
      const timeRemaining = document.getElementById('modalTimeRemaining').textContent;
      const status = document.getElementById('modalStatus').textContent;

      const output = ` BREAK UPDATE - ${timeStr}

 PROGRESS:
Inducted: ${inductedSoFar}
Stowed: ${stowedSoFar}

 REMAINING:
Induct: ${remainingInduct}
Stow: ${remainingStow}

 REQUIRED FLOW:
Induct Flow Needed: ${inductFlow} TPH
Stow Flow Needed: ${stowFlow} TPH

 Target Finish: ${targetTime}
 Time Remaining: ${timeRemaining}
 Status: ${status}`;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(output).then(() => {
          showBreakCopyConfirm();
        }).catch(() => {
          fallbackBreakCopy(output);
        });
      } else {
        fallbackBreakCopy(output);
      }
    }

    function fallbackBreakCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      showBreakCopyConfirm();
    }

    function showBreakCopyConfirm() {
      const confirm = document.getElementById('breakCopyConfirm');
      confirm.classList.add('show');
      setTimeout(() => confirm.classList.remove('show'), 2000);
    }

    // Close modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeBreakModal();
    });

    // Close modal on overlay click
    document.getElementById('breakModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('breakModal')) closeBreakModal();
    });

    // Initialize
    loadWeeklyRates(); // Load Sort Wash rates if available
    loadPreshiftData(); // Load Pre-Shift Planning data if available
    calculateRunTime();
    calculatePreshift(); // Initialize preshift calculations

    // ==================== LOAD PRE-SHIFT DATA ====================
    function loadPreshiftData() {
      const savedData = localStorage.getItem('preshiftData');
      if (savedData) {
        const preshift = JSON.parse(savedData);
        
        // Check if data is from today (within last 24 hours)
        const savedTime = new Date(preshift.timestamp);
        const now = new Date();
        const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
        
        if (hoursDiff < 24 && preshift.c1Volume > 0) {
          // Set C1 Volume
          document.getElementById('totalVolume').value = preshift.c1Volume;
          
          // Show indicator that pre-shift data was loaded
          showPreshiftLoaded(preshift);
          
          // Trigger calculations
          updateStats();
          
          console.log('Loaded Pre-Shift data:', preshift);
        }
      }
    }

    function showPreshiftLoaded(preshift) {
      const volumeInput = document.getElementById('totalVolume');
      if (volumeInput) {
        // Add a visual indicator
        volumeInput.style.borderColor = '#3FB950';
        volumeInput.style.boxShadow = '0 0 0 3px rgba(63, 185, 80, 0.3)';
        
        // Show a toast notification
        const toast = document.createElement('div');
        toast.innerHTML = ` Pre-Shift data loaded: Volume ${preshift.c1Volume.toLocaleString()} | HC ${preshift.plannedHC}`;
        toast.style.cssText = `
          position: fixed;
          top: 80px;
          left: 50%;
          transform: translateX(-50%);
          background: linear-gradient(135deg, #3FB950 0%, #2da44e 100%);
          color: white;
          padding: 1rem 2rem;
          border-radius: 8px;
          font-weight: 600;
          z-index: 1000;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        document.body.appendChild(toast);
        
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transition = 'opacity 0.3s';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
    }

    // ==================== PRE-SHIFT PLANNER ====================
    function calculatePreshift() {
      const volume = parseFloat(document.getElementById('preshiftVolume').value) || 0;
      const plannedHC = parseFloat(document.getElementById('preshiftPlannedHC').value) || 0;
      const plannedHours = parseFloat(document.getElementById('preshiftPlannedHours').value) || 0;
      const projectedHours = parseFloat(document.getElementById('preshiftProjectedHours').value) || 0;
      const tph = parseFloat(document.getElementById('preshiftTPH').value) || 90;

      // Calculate Direct Hours
      const directHours = volume > 0 && tph > 0 ? (volume / tph) : 0;
      document.getElementById('modelDirectHours').textContent = directHours.toFixed(1);

      // Calculate Indirect Factor
      const indirectFactor = directHours > 0 && plannedHours > 0 ? (plannedHours / directHours) : 1.17;
      document.getElementById('modelIndirectFactor').textContent = indirectFactor.toFixed(2);

      // Calculate Hours per AA
      const hoursPerAA = plannedHC > 0 && plannedHours > 0 ? (plannedHours / plannedHC) : 7.2;
      document.getElementById('modelHoursPerAA').textContent = hoursPerAA.toFixed(2);

      // Calculate Hours Gap
      const hoursGap = projectedHours - plannedHours;
      document.getElementById('modelHoursGap').textContent = hoursGap > 0 ? `+${hoursGap.toFixed(0)}` : hoursGap.toFixed(0);

      // Store values for Same Day calculation
      window.preshiftModel = {
        volume,
        plannedHC,
        plannedHours,
        tph,
        indirectFactor,
        hoursPerAA
      };

      // Recalculate with Same Day if there's a value
      calculateWithSameday();
    }

    function calculateWithSameday() {
      const model = window.preshiftModel || {
        volume: 0,
        plannedHC: 0,
        plannedHours: 0,
        tph: 90,
        indirectFactor: 1.17,
        hoursPerAA: 7.2
      };

      const samedayVolume = parseFloat(document.getElementById('addSamedayVolume').value) || 0;

      // New Total Volume
      const newTotalVolume = model.volume + samedayVolume;
      document.getElementById('newTotalVolume').textContent = newTotalVolume.toLocaleString();

      // New Planned Hours = (New Volume  TPH)  Indirect Factor
      const newPlannedHours = model.tph > 0 ? (newTotalVolume / model.tph) * model.indirectFactor : 0;
      document.getElementById('newPlannedHours').textContent = Math.round(newPlannedHours).toLocaleString();

      // New Planned HC = New Planned Hours  Hours per AA
      const newPlannedHC = model.hoursPerAA > 0 ? Math.ceil(newPlannedHours / model.hoursPerAA) : 0;
      document.getElementById('newPlannedHC').textContent = newPlannedHC;

      // Extra HC Needed
      const extraHC = newPlannedHC - model.plannedHC;
      document.getElementById('extraHCNeeded').textContent = extraHC > 0 ? `+${extraHC}` : extraHC.toString();
    }

    function clearPreshift() {
      document.getElementById('preshiftVolume').value = '';
      document.getElementById('preshiftFPH').value = '';
      document.getElementById('preshiftPlannedHC').value = '';
      document.getElementById('preshiftPlannedHours').value = '';
      document.getElementById('preshiftProjectedHours').value = '';
      document.getElementById('preshiftTPH').value = '90';
      document.getElementById('addSamedayVolume').value = '';
      calculatePreshift();
    }

    function applyPreshiftToStaffing() {
      const volume = parseFloat(document.getElementById('preshiftVolume').value) || 0;
      const samedayVolume = parseFloat(document.getElementById('addSamedayVolume').value) || 0;
      
      // Set C1 Volume in staffing calculator
      document.getElementById('totalVolume').value = volume;
      
      // Set Same Day volume if entered
      if (samedayVolume > 0) {
        // Split between sunrise and sameday (can adjust ratio)
        document.getElementById('sunriseVolume').value = Math.round(samedayVolume * 0.6);
        document.getElementById('samedayVolume').value = Math.round(samedayVolume * 0.4);
        calculateSameDay();
      }
      
      // Trigger recalculation
      updateStats();
      
      // Scroll to staffing section
      document.getElementById('staffingSummary').scrollIntoView({ behavior: 'smooth' });
    }

    // ==================== WIP COMPLIANCE ====================
    function calculateWIP() {
      const wipUnits = parseFloat(document.getElementById('wipUnits').value) || 0;
      const stowRate = parseFloat(document.getElementById('wipStowRate').value) || 0;
      const targetMin = parseFloat(document.getElementById('wipTargetMin').value) || 10;
      const targetMax = parseFloat(document.getElementById('wipTargetMax').value) || 20;

      // Update labels
      document.getElementById('bufferMinLabel').textContent = targetMin;
      document.getElementById('bufferMaxLabel').textContent = targetMax;

      // Calculate buffer minutes
      const ratePerMinute = stowRate / 60;
      const bufferMinutes = (ratePerMinute > 0) ? wipUnits / ratePerMinute : 0;
      
      const bufferValueEl = document.getElementById('bufferMinutes');
      bufferValueEl.textContent = bufferMinutes.toFixed(1);

      // Update status and colors
      const wipStatus = document.getElementById('wipStatus');
      const wipActions = document.getElementById('wipActions');
      const wipActionText = document.getElementById('wipActionText');
      const bufferMarker = document.getElementById('bufferMarker');

      // Calculate marker position (0-100%)
      const maxDisplay = targetMax * 1.5; // Show up to 1.5x max
      let markerPos = (bufferMinutes / maxDisplay) * 100;
      markerPos = Math.min(Math.max(markerPos, 0), 100);
      bufferMarker.style.left = markerPos + '%';

      if (wipUnits === 0 || stowRate === 0) {
        // No data entered
        wipStatus.textContent = 'Enter Data';
        wipStatus.className = 'wip-status';
        bufferValueEl.className = 'buffer-value';
        wipActions.className = 'wip-actions';
        wipActionText.textContent = 'Enter WIP units and stow rate to see recommendations';
      } else if (bufferMinutes < targetMin) {
        // Too low - starving
        wipStatus.textContent = ' LOW - Starving';
        wipStatus.className = 'wip-status critical';
        bufferValueEl.className = 'buffer-value low';
        wipActions.className = 'wip-actions action-increase';
        wipActionText.innerHTML = `<strong>WIP TOO LOW - Downstream may run out of work!</strong><br>
           <strong>Increase feed:</strong> Raise induct/sort rate<br>
           <strong>Move carts/racks:</strong> Push buffer to starving clusters<br>
           <strong>Temporarily reduce stow HC:</strong> Avoid idle walking until buffer builds<br>
           Target: Get buffer to ${targetMin}-${targetMax} minutes`;
      } else if (bufferMinutes > targetMax) {
        // Too high - flooding
        wipStatus.textContent = ' HIGH - Flooding';
        wipStatus.className = 'wip-status warning';
        bufferValueEl.className = 'buffer-value high';
        wipActions.className = 'wip-actions action-decrease';
        wipActionText.innerHTML = `<strong>WIP TOO HIGH - Risk of congestion!</strong><br>
           <strong>Reduce feed:</strong> Slow induct/sort or pause building new WIP<br>
           <strong>Add stowers:</strong> Shift labor to heavy WIP areas<br>
           <strong>Drain worst clusters first:</strong> Focus on highest risk zones<br>
           <strong>Clear PS/jams:</strong> Stop dirty WIP from growing<br>
           Target: Get buffer down to ${targetMin}-${targetMax} minutes`;
      } else {
        // In range - compliant
        wipStatus.textContent = ' COMPLIANT';
        wipStatus.className = 'wip-status compliant';
        bufferValueEl.className = 'buffer-value good';
        wipActions.className = 'wip-actions action-hold';
        wipActionText.innerHTML = `<strong>WIP is in target range - maintain current flow!</strong><br>
           Buffer: ${bufferMinutes.toFixed(1)} min (Target: ${targetMin}-${targetMax} min)<br>
           Keep feed rate matched to process rate<br>
           Monitor cluster balance for even distribution`;
      }
    }

    // ==================== SAME DAY CALCULATIONS ====================
    function calculateSameDay() {
      const shiftStart = document.getElementById('shiftStart').value || '01:20';
      const [startHour, startMin] = shiftStart.split(':').map(Number);
      
      // Sunrise calculation
      const sunriseVolume = parseInt(document.getElementById('sunriseVolume').value) || 0;
      const sunriseDeadline = document.getElementById('sunriseDeadline').value || '03:30';
      const [sunriseEndHour, sunriseEndMin] = sunriseDeadline.split(':').map(Number);
      
      // Calculate sunrise time window (from shift start to deadline)
      let sunriseMinutes = (sunriseEndHour * 60 + sunriseEndMin) - (startHour * 60 + startMin);
      if (sunriseMinutes < 0) sunriseMinutes += 24 * 60; // Handle overnight
      const sunriseHours = sunriseMinutes / 60;
      
      const sunriseWindowH = Math.floor(sunriseHours);
      const sunriseWindowM = Math.round((sunriseHours - sunriseWindowH) * 60);
      document.getElementById('sunriseWindow').textContent = `${sunriseWindowH}h ${sunriseWindowM}m`;
      
      const sunriseFlow = sunriseHours > 0 ? Math.round(sunriseVolume / sunriseHours) : 0;
      document.getElementById('sunriseFlow').textContent = sunriseFlow.toLocaleString();
      
      // Initialize sunrise left to induct/stow
      document.getElementById('sunriseLeftInduct').textContent = sunriseVolume.toLocaleString();
      document.getElementById('sunriseLeftStow').textContent = sunriseVolume.toLocaleString();
      
      // Same Day AM calculation
      const samedayVolume = parseInt(document.getElementById('samedayVolume').value) || 0;
      const samedayStart = document.getElementById('samedayStart').value || '03:00';
      const samedayDeadline = document.getElementById('samedayDeadline').value || '03:30';
      
      const [sdStartHour, sdStartMin] = samedayStart.split(':').map(Number);
      const [sdEndHour, sdEndMin] = samedayDeadline.split(':').map(Number);
      
      let samedayMinutes = (sdEndHour * 60 + sdEndMin) - (sdStartHour * 60 + sdStartMin);
      if (samedayMinutes < 0) samedayMinutes += 24 * 60;
      const samedayHours = samedayMinutes / 60;
      
      const samedayWindowH = Math.floor(samedayHours);
      const samedayWindowM = Math.round((samedayHours - samedayWindowH) * 60);
      document.getElementById('samedayWindow').textContent = `${samedayWindowH}h ${samedayWindowM}m`;
      
      const samedayFlow = samedayHours > 0 ? Math.round(samedayVolume / samedayHours) : 0;
      document.getElementById('samedayFlow').textContent = samedayFlow.toLocaleString();
      
      // Initialize sameday left to induct/stow
      document.getElementById('samedayLeftInduct').textContent = samedayVolume.toLocaleString();
      document.getElementById('samedayLeftStow').textContent = samedayVolume.toLocaleString();
      
      // Combined SSD flow (use the higher requirement)
      const totalSSDVolume = sunriseVolume + samedayVolume;
      // Use sunrise window since that's the primary constraint
      const ssdRequiredFlow = Math.max(sunriseFlow, samedayFlow);
      
      // Calculate SSD staffing - P2B and Stowers only (pulled from Sort Side)
      // P2B minimum is 6
      const ssdP2BCalc = ssdRequiredFlow > 0 ? Math.ceil(ssdRequiredFlow / PPH.pickToBuffer) : 0;
      const ssdP2B = Math.max(6, ssdP2BCalc); // Minimum 6 P2B
      
      // Stowers using efficiency
      const stowRatePPH = parseFloat(document.getElementById('stowRatePPH').value) || 260;
      const efficiencyPercent = parseFloat(document.getElementById('efficiencyPercent').value) || 85;
      const effectiveStowPPH = stowRatePPH * (efficiencyPercent / 100);
      const ssdStowers = ssdRequiredFlow > 0 ? Math.ceil(ssdRequiredFlow / effectiveStowPPH) : 0;
      
      document.getElementById('ssdP2B').textContent = ssdP2B;
      document.getElementById('ssdStowers').textContent = ssdStowers;
      
      const ssdTotalHC = ssdP2B + ssdStowers;
      document.getElementById('ssdTotalHC').textContent = ssdTotalHC;
      document.getElementById('pullFromC1').textContent = ssdTotalHC;
      
      // Update status
      const ssdStatus = document.getElementById('ssdStatus');
      if (totalSSDVolume > 0) {
        ssdStatus.textContent = 'Active';
        ssdStatus.classList.add('active');
      } else {
        ssdStatus.textContent = 'Not Started';
        ssdStatus.classList.remove('active');
      }
      
      // Calculate C1 adjusted flow (pull from Sort Side only)
      updateC1Adjusted(ssdTotalHC);
    }

    function updateC1Adjusted(ssdHC) {
      // Get original C1 Sort Side HC only (not Dock)
      const originalSortHC = parseInt(document.getElementById('recStowHC').textContent) || 0;
      
      document.getElementById('originalC1HC').textContent = originalSortHC;
      document.getElementById('pulledForSSD').textContent = ssdHC;
      
      const remainingSortHC = Math.max(0, originalSortHC - ssdHC);
      document.getElementById('remainingC1HC').textContent = remainingSortHC;
      
      // Calculate adjusted C1 flow based on remaining Sort Side HC
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      const runTimeText = document.getElementById('totalRunTime').textContent;
      const [hours, mins] = runTimeText.split(':').map(Number);
      const runTimeHours = hours + (mins / 60);
      
      if (originalSortHC > 0 && runTimeHours > 0) {
        const originalFlow = totalVolume / runTimeHours;
        const flowRatio = remainingSortHC / originalSortHC;
        const adjustedFlow = Math.round(originalFlow * flowRatio);
        document.getElementById('adjustedC1Flow').textContent = adjustedFlow.toLocaleString();
      } else {
        document.getElementById('adjustedC1Flow').textContent = '0';
      }
    }

    // ==================== SUNRISE & SAME DAY PROGRESS ====================
    function updateSunriseProgress() {
      const sunriseVolume = parseInt(document.getElementById('sunriseVolume').value) || 0;
      const inducted = parseInt(document.getElementById('sunriseInducted').value) || 0;
      const stowed = parseInt(document.getElementById('sunriseStowed').value) || 0;
      
      const leftInduct = Math.max(0, sunriseVolume - inducted);
      const leftStow = Math.max(0, sunriseVolume - stowed);
      
      document.getElementById('sunriseLeftInduct').textContent = leftInduct.toLocaleString();
      document.getElementById('sunriseLeftStow').textContent = leftStow.toLocaleString();
    }

    function updateSamedayProgress() {
      const samedayVolume = parseInt(document.getElementById('samedayVolume').value) || 0;
      const inducted = parseInt(document.getElementById('samedayInducted').value) || 0;
      const stowed = parseInt(document.getElementById('samedayStowed').value) || 0;
      
      const leftInduct = Math.max(0, samedayVolume - inducted);
      const leftStow = Math.max(0, samedayVolume - stowed);
      
      document.getElementById('samedayLeftInduct').textContent = leftInduct.toLocaleString();
      document.getElementById('samedayLeftStow').textContent = leftStow.toLocaleString();
    }

    function copySunriseUpdate() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      
      const volume = document.getElementById('sunriseVolume').value || '0';
      const inducted = document.getElementById('sunriseInducted').value || '0';
      const stowed = document.getElementById('sunriseStowed').value || '0';
      const leftInduct = document.getElementById('sunriseLeftInduct').textContent;
      const leftStow = document.getElementById('sunriseLeftStow').textContent;
      const deadline = document.getElementById('sunriseDeadline').value || '03:30';
      const requiredFlow = document.getElementById('sunriseFlow').textContent;
      
      // Format deadline
      const [h, m] = deadline.split(':').map(Number);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const h12 = h % 12 || 12;
      const deadlineStr = `${h12}:${String(m).padStart(2, '0')} ${ampm}`;
      
      const output = ` SUNRISE UPDATE - ${timeStr}

 Volume: ${parseInt(volume).toLocaleString()}
 Inducted: ${parseInt(inducted).toLocaleString()}
 Stowed: ${parseInt(stowed).toLocaleString()}
 Left to Induct: ${leftInduct}
 Left to Stow: ${leftStow}

 Must Finish By: ${deadlineStr}
 Required Flow: ${requiredFlow} TPH`;

      copyToClipboard(output, 'sunriseCopyConfirm');
    }

    function copySamedayUpdate() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      
      const volume = document.getElementById('samedayVolume').value || '0';
      const inducted = document.getElementById('samedayInducted').value || '0';
      const stowed = document.getElementById('samedayStowed').value || '0';
      const leftInduct = document.getElementById('samedayLeftInduct').textContent;
      const leftStow = document.getElementById('samedayLeftStow').textContent;
      const deadline = document.getElementById('samedayDeadline').value || '03:30';
      const requiredFlow = document.getElementById('samedayFlow').textContent;
      
      // Format deadline
      const [h, m] = deadline.split(':').map(Number);
      const ampm = h >= 12 ? 'PM' : 'AM';
      const h12 = h % 12 || 12;
      const deadlineStr = `${h12}:${String(m).padStart(2, '0')} ${ampm}`;
      
      const output = ` SAME DAY AM UPDATE - ${timeStr}

 Volume: ${parseInt(volume).toLocaleString()}
 Inducted: ${parseInt(inducted).toLocaleString()}
 Stowed: ${parseInt(stowed).toLocaleString()}
 Left to Induct: ${leftInduct}
 Left to Stow: ${leftStow}

 Must Finish By: ${deadlineStr}
 Required Flow: ${requiredFlow} TPH`;

      copyToClipboard(output, 'samedayCopyConfirm');
    }

    function copyToClipboard(text, confirmId) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          showCopyConfirmById(confirmId);
        }).catch(() => {
          fallbackCopyToClipboard(text, confirmId);
        });
      } else {
        fallbackCopyToClipboard(text, confirmId);
      }
    }

    function fallbackCopyToClipboard(text, confirmId) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      showCopyConfirmById(confirmId);
    }

    function showCopyConfirmById(confirmId) {
      const confirm = document.getElementById(confirmId);
      if (confirm) {
        confirm.classList.add('show');
        setTimeout(() => confirm.classList.remove('show'), 2000);
      }
    }

    // ==================== HOURLY REPORT ====================
    function openReportModal() {
      generateReport();
      document.getElementById('reportModal').classList.add('active');
    }

    function closeReportModal() {
      document.getElementById('reportModal').classList.remove('active');
    }

    function generateReport() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
      const dateStr = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' });
      
      // Get all the values
      const totalVolume = parseInt(document.getElementById('totalVolume').value) || 0;
      const inductedSoFar = parseInt(document.getElementById('inductedSoFar').value) || 0;
      const stowedSoFar = parseInt(document.getElementById('stowedSoFar').value) || 0;
      const remainingInduct = Math.max(0, totalVolume - inductedSoFar);
      const remainingStow = Math.max(0, totalVolume - stowedSoFar);
      
      // Calculate time remaining
      const shiftEnd = document.getElementById('earlyEnd').value || document.getElementById('shiftEnd').value;
      const [endHour, endMin] = shiftEnd.split(':').map(Number);
      let endDate = new Date();
      endDate.setHours(endHour, endMin, 0, 0);
      if (endDate < now) endDate.setDate(endDate.getDate() + 1);
      
      const msRemaining = endDate - now;
      const hoursRemaining = msRemaining / (1000 * 60 * 60);
      
      // Calculate remaining breaks
      let breakMinsRemaining = 0;
      const currentHour = now.getHours();
      const currentMin = now.getMinutes();
      const currentTimeValue = currentHour + (currentMin / 60);
      
      if (currentTimeValue < 4.25 && document.getElementById('break1').checked) breakMinsRemaining += 15;
      if (currentTimeValue < 6.5 && document.getElementById('lunch').checked) breakMinsRemaining += 30;
      if (currentTimeValue < 9 && document.getElementById('break2').checked) breakMinsRemaining += 15;
      
      const effectiveHoursRemaining = Math.max(0, hoursRemaining - (breakMinsRemaining / 60));
      
      // Calculate required flow rates
      const requiredInductFlow = effectiveHoursRemaining > 0 ? Math.round(remainingInduct / effectiveHoursRemaining) : 0;
      const requiredStowFlow = effectiveHoursRemaining > 0 ? Math.round(remainingStow / effectiveHoursRemaining) : 0;
      
      // Get actual headcount - sum up all actual HC inputs
      let actualHC = 0;
      const actualInputs = document.querySelectorAll('.actual-input');
      actualInputs.forEach(input => {
        actualHC += parseInt(input.value) || 0;
      });
      const plannedHC = parseInt(document.getElementById('recTotalHC')?.textContent) || 0;
      const hcDiff = actualHC - plannedHC;
      let hcStatus = 'AT HC';
      if (hcDiff < 0) hcStatus = `UNDER HC (${hcDiff})`;
      if (hcDiff > 0) hcStatus = `OVER HC (+${hcDiff})`;
      
      // Calculate percent complete
      const inductPercent = totalVolume > 0 ? Math.round((inductedSoFar / totalVolume) * 100) : 0;
      const stowPercent = totalVolume > 0 ? Math.round((stowedSoFar / totalVolume) * 100) : 0;
      
      // Format time remaining
      const hoursLeft = Math.floor(effectiveHoursRemaining);
      const minsLeft = Math.round((effectiveHoursRemaining - hoursLeft) * 60);
      const timeRemaining = `${hoursLeft}h ${minsLeft}m`;

      // Build the report text (plain text for copy/paste)
      const reportText = ` HOURLY UPDATE - ${timeStr}
${dateStr}


 INDUCT
 Volume Inducted: ${inductedSoFar.toLocaleString()} (${inductPercent}%)
 Remaining: ${remainingInduct.toLocaleString()}
 Flow Needed: ${requiredInductFlow.toLocaleString()} TPH

 STOW
 Volume Stowed: ${stowedSoFar.toLocaleString()} (${stowPercent}%)
 Remaining: ${remainingStow.toLocaleString()}
 Flow Needed: ${requiredStowFlow.toLocaleString()} TPH

 HEADCOUNT
 Planned: ${plannedHC}
 Actual: ${actualHC}
 Status: ${hcStatus}

 TIME
 Remaining: ${timeRemaining}
 Target End: ${document.getElementById('shiftEnd').value}

`;

      // Display in modal
      document.getElementById('reportPreview').textContent = reportText;
      
      // Store for copying
      window.currentReportText = reportText;
    }

    function copyReport() {
      const reportText = window.currentReportText;
      
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(reportText).then(() => {
          showCopyConfirm();
        }).catch(err => {
          fallbackCopy(reportText);
        });
      } else {
        fallbackCopy(reportText);
      }
    }

    function fallbackCopy(text) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = '0';
      document.body.appendChild(textarea);
      textarea.select();
      document.execCommand('copy');
      document.body.removeChild(textarea);
      showCopyConfirm();
    }

    function showCopyConfirm() {
      const confirm = document.getElementById('copyConfirm');
      confirm.classList.add('show');
      setTimeout(() => {
        confirm.classList.remove('show');
      }, 2000);
    }

    // Close report modal on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeReportModal();
        closeBreakModal();
      }
    });

    // Close report modal on overlay click
    document.getElementById('reportModal').addEventListener('click', (e) => {
      if (e.target === document.getElementById('reportModal')) closeReportModal();
    });

    // ==================== VOICE RECOGNITION ====================
    let recognition = null;
    let isListening = false;

    // Check if browser supports speech recognition
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onstart = function() {
        isListening = true;
        document.getElementById('voiceBtn').classList.add('listening');
        document.getElementById('voiceBtnText').textContent = 'LISTENING...';
        showVoiceToast('', 'Listening...', 'Say a command like "Waterspider 5"');
      };

      recognition.onend = function() {
        if (isListening) {
          // Restart if still supposed to be listening
          recognition.start();
        }
      };

      recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        if (event.error === 'not-allowed') {
          showVoiceToast('', 'Microphone access denied', 'Please allow microphone access in your browser', 'error');
          stopVoice();
        }
      };

      recognition.onresult = function(event) {
        const last = event.results.length - 1;
        const transcript = event.results[last][0].transcript.trim().toLowerCase();
        console.log('Heard:', transcript);
        processVoiceCommand(transcript);
      };
    }

    function toggleVoice() {
      if (!SpeechRecognition) {
        showVoiceToast('', 'Voice not supported', 'Please use Chrome for voice commands', 'error');
        return;
      }

      if (isListening) {
        stopVoice();
      } else {
        startVoice();
      }
    }

    function startVoice() {
      if (recognition) {
        isListening = true;
        recognition.start();
      }
    }

    function stopVoice() {
      isListening = false;
      if (recognition) {
        recognition.stop();
      }
      document.getElementById('voiceBtn').classList.remove('listening');
      document.getElementById('voiceBtnText').textContent = 'VOICE';
      hideVoiceToast();
    }

    function showVoiceToast(icon, text, action, type = '') {
      const toast = document.getElementById('voiceToast');
      toast.querySelector('.voice-toast-icon').textContent = icon;
      document.getElementById('voiceHeard').innerHTML = text;
      document.getElementById('voiceAction').textContent = action || '';
      toast.className = 'voice-toast active ' + type;
      
      // Auto-hide after 3 seconds for success/error
      if (type) {
        setTimeout(hideVoiceToast, 3000);
      }
    }

    function hideVoiceToast() {
      if (!isListening) {
        document.getElementById('voiceToast').classList.remove('active');
      }
    }

    // Voice command mappings
    const voiceCommands = {
      // Staffing - C1 Dock
      'waterspider': 'c1WaterspiderActual',
      'water spider': 'c1WaterspiderActual',
      'line loader': 'c1LineloaderActual',
      'lineloader': 'c1LineloaderActual',
      'inductor': 'c1InductersActual',
      'inductors': 'c1InductersActual',
      'inducters': 'c1InductersActual',
      'induct': 'c1InductersActual',
      'pusher': 'c1PushersActual',
      'pushers': 'c1PushersActual',
      
      // Staffing - C1 Sort
      'diverter': 'c1DiverterActual',
      'diverters': 'c1DiverterActual',
      'p2b a': 'c1P2BAActual',
      'p2b alpha': 'c1P2BAActual',
      'p2b b': 'c1P2BBActual',
      'p2b bravo': 'c1P2BBActual',
      'p2b c': 'c1P2BCActual',
      'p2b charlie': 'c1P2BCActual',
      'p2b d': 'c1P2BDActual',
      'p2b delta': 'c1P2BDActual',
      'p2b e': 'c1P2BEActual',
      'p2b echo': 'c1P2BEActual',
      'p2b g': 'c1P2BGActual',
      'p2b golf': 'c1P2BGActual',
      
      // SSD
      'ssd waterspider': 'ssdWaterspiderActual',
      'ssd water spider': 'ssdWaterspiderActual',
      'ssd lineloader': 'ssdLineloaderActual',
      'ssd line loader': 'ssdLineloaderActual',
      'ssd inducters': 'ssdInductersActual',
      'ssd inductors': 'ssdInductersActual',
      'ssd pushers': 'ssdPushersActual',
      'ssd pusher': 'ssdPushersActual',
      'ssd p2b': 'ssdP2BActual',
      
      // Indirects
      'problem solve': 'problemSolveActual',
      'problem solver': 'problemSolveActual',
      'hazmat': 'hazmatActual',
      'yard assist': 'yardAssistActual',
      'yard': 'yardAssistActual',
      'process assistant': 'paActual',
      'pa': 'paActual',
      'safety': 'safetyActual',
      '5s': 'fiveSActual',
      'five s': 'fiveSActual',
      
      // Volumes
      'total volume': 'totalVolume',
      'volume': 'totalVolume',
      'cluster a': 'clusterA',
      'cluster alpha': 'clusterA',
      'cluster ay': 'clusterA',
      'cluster b': 'clusterB',
      'cluster bravo': 'clusterB',
      'cluster be': 'clusterB',
      'cluster bee': 'clusterB',
      'cluster c': 'clusterC',
      'cluster charlie': 'clusterC',
      'cluster see': 'clusterC',
      'cluster sea': 'clusterC',
      'cluster d': 'clusterD',
      'cluster delta': 'clusterD',
      'cluster de': 'clusterD',
      'cluster dee': 'clusterD',
      'cluster the': 'clusterD',
      'cluster e': 'clusterE',
      'cluster echo': 'clusterE',
      'cluster ee': 'clusterE',
      'cluster g': 'clusterG',
      'cluster golf': 'clusterG',
      'cluster gee': 'clusterG',
      'cluster ji': 'clusterG',
      
      // Progress
      'inducted': 'inductedSoFar',
      'inducted so far': 'inductedSoFar',
      'stowed': 'stowedSoFar',
      'stowed so far': 'stowedSoFar',
      
      // Pre-shift
      'c1 volume': 'c1Volume',
      'cycle 1 volume': 'c1Volume',
      'fph': 'fph',
      'flow per hour': 'fph',
      'target tph': 'targetTPH',
      'planned hc': 'plannedHC',
      'planned headcount': 'plannedHC',
      'planned hours': 'plannedHours',
      'projected hours': 'projectedHours'
    };

    function processVoiceCommand(transcript) {
      console.log('Raw transcript:', transcript);
      
      // Convert spoken numbers to digits
      let processed = transcript.toLowerCase()
        // Handle "X thousand" patterns first
        .replace(/one thousand/g, '1000')
        .replace(/two thousand/g, '2000')
        .replace(/three thousand/g, '3000')
        .replace(/four thousand/g, '4000')
        .replace(/five thousand/g, '5000')
        .replace(/six thousand/g, '6000')
        .replace(/seven thousand/g, '7000')
        .replace(/eight thousand/g, '8000')
        .replace(/nine thousand/g, '9000')
        .replace(/ten thousand/g, '10000')
        .replace(/eleven thousand/g, '11000')
        .replace(/twelve thousand/g, '12000')
        .replace(/thirteen thousand/g, '13000')
        .replace(/fourteen thousand/g, '14000')
        .replace(/fifteen thousand/g, '15000')
        .replace(/sixteen thousand/g, '16000')
        .replace(/seventeen thousand/g, '17000')
        .replace(/eighteen thousand/g, '18000')
        .replace(/nineteen thousand/g, '19000')
        .replace(/twenty thousand/g, '20000')
        .replace(/thirty thousand/g, '30000')
        .replace(/forty thousand/g, '40000')
        .replace(/fifty thousand/g, '50000')
        .replace(/sixty thousand/g, '60000')
        .replace(/seventy thousand/g, '70000')
        .replace(/eighty thousand/g, '80000')
        .replace(/ninety thousand/g, '90000')
        // Handle "X hundred" patterns
        .replace(/one hundred/g, '100')
        .replace(/two hundred/g, '200')
        .replace(/three hundred/g, '300')
        .replace(/four hundred/g, '400')
        .replace(/five hundred/g, '500')
        .replace(/six hundred/g, '600')
        .replace(/seven hundred/g, '700')
        .replace(/eight hundred/g, '800')
        .replace(/nine hundred/g, '900')
        // Handle remaining single numbers
        .replace(/\bone\b/g, '1')
        .replace(/\btwo\b/g, '2')
        .replace(/\bthree\b/g, '3')
        .replace(/\bfour\b/g, '4')
        .replace(/\bfive\b/g, '5')
        .replace(/\bsix\b/g, '6')
        .replace(/\bseven\b/g, '7')
        .replace(/\beight\b/g, '8')
        .replace(/\bnine\b/g, '9')
        .replace(/\bten\b/g, '10')
        .replace(/\beleven\b/g, '11')
        .replace(/\btwelve\b/g, '12')
        .replace(/\bthirteen\b/g, '13')
        .replace(/\bfourteen\b/g, '14')
        .replace(/\bfifteen\b/g, '15')
        // Handle "thousand" after a number (e.g., "9 thousand" or "48 thousand")
        .replace(/(\d+)\s*thousand/g, function(match, num) { return parseInt(num) * 1000; })
        .replace(/(\d+)\s*hundred/g, function(match, num) { return parseInt(num) * 100; })
        // Remove commas
        .replace(/,/g, '');
      
      console.log('Processed transcript:', processed);
      
      // Extract ALL numbers and combine them (for cases like "forty eight thousand" -> "40" "8" "000")
      const numbers = processed.match(/\d+/g);
      if (!numbers) {
        showVoiceToast('', `"${transcript}"`, 'No number detected - say something like "Waterspider 5"');
        return;
      }
      
      // Sum up numbers if multiple found close together, or take the largest
      let number;
      if (numbers.length === 1) {
        number = parseInt(numbers[0]);
      } else {
        // Check if we should add them (like 40 + 8 + 1000 for "forty eight thousand")
        // Or just take the largest one
        const sum = numbers.reduce((a, b) => parseInt(a) + parseInt(b), 0);
        const max = Math.max(...numbers.map(n => parseInt(n)));
        // If max is 1000+, it's probably the intended number
        number = max >= 1000 ? max : sum;
      }
      
      console.log('Extracted number:', number);
      
      // Remove all numbers to get the command
      const commandText = processed.replace(/\d+/g, '').trim();
      
      // Find matching command
      let matchedField = null;
      let matchedCommand = null;
      
      for (const [command, fieldId] of Object.entries(voiceCommands)) {
        if (commandText.includes(command) || command.includes(commandText)) {
          matchedField = fieldId;
          matchedCommand = command;
          break;
        }
      }
      
      if (matchedField) {
        const input = document.getElementById(matchedField);
        if (input) {
          input.value = number;
          // Trigger the input event to update calculations
          input.dispatchEvent(new Event('input', { bubbles: true }));
          
          showVoiceToast('', `<span class="heard">${matchedCommand}: ${number.toLocaleString()}</span>`, 'Value updated!', 'success');
          
          // Keep listening indicator
          setTimeout(() => {
            if (isListening) {
              showVoiceToast('', 'Listening...', 'Say another command');
            }
          }, 2000);
        }
      } else {
        showVoiceToast('', `"${transcript}"`, 'Command not recognized - try "Waterspider 5"');
      }
    }

    // ==================== GOOGLE SHEETS SYNC ====================
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbybFEFYa9c3mVSWo0PHROF3-fYNSjT0sJsQd5QEMwAH-ByFWP35_Vktvr40uQm8jsJ5Ag/exec';
    const PAGE_NAME = 'pph-flow-staffing';

    // Save to Google Sheets
    async function saveToCloud() {
      const data = [
        new Date().toISOString(),
        PAGE_NAME,
        document.getElementById('totalVolume').value || '',
        document.getElementById('inductedSoFar').value || '',
        document.getElementById('stowedSoFar').value || '',
        document.getElementById('remainingInduct').value || '',
        document.getElementById('remainingStow').value || '',
        document.getElementById('sunriseVolume').value || '',
        document.getElementById('samedayVolume').value || '',
        document.getElementById('stowRatePPH').value || '260',
        document.getElementById('shiftStart').value || '01:20',
        document.getElementById('shiftEnd').value || '08:30',
        document.getElementById('sunriseInducted').value || '',
        document.getElementById('sunriseStowed').value || '',
        document.getElementById('samedayInducted').value || '',
        document.getElementById('samedayStowed').value || '',
        document.getElementById('clusterA').value || '',
        document.getElementById('clusterB').value || '',
        document.getElementById('clusterC').value || '',
        document.getElementById('clusterD').value || '',
        document.getElementById('clusterE').value || '',
        document.getElementById('clusterG').value || '',
        document.getElementById('targetFinishTime').value || '08:00',
        document.getElementById('efficiencyPercent').value || '85'
      ];
      
      try {
        const url = `${GOOGLE_SCRIPT_URL}?action=update&data=${encodeURIComponent(JSON.stringify(data))}`;
        await fetch(url, { mode: 'no-cors' });
        showSyncStatus('saved');
      } catch (error) {
        console.error('Cloud save error:', error);
        showSyncStatus('error');
      }
    }

    // Load from Google Sheets
    async function loadFromCloud() {
      try {
        showSyncStatus('loading');
        const url = `${GOOGLE_SCRIPT_URL}?action=getPage&page=${PAGE_NAME}`;
        const response = await fetch(url);
        const result = await response.json();
        
        if (result.success && result.data) {
          const data = result.data;
          // data[0] = timestamp, data[1] = page name, data[2+] = values
          if (data[2]) document.getElementById('totalVolume').value = data[2];
          if (data[3]) document.getElementById('inductedSoFar').value = data[3];
          if (data[4]) document.getElementById('stowedSoFar').value = data[4];
          if (data[5]) document.getElementById('remainingInduct').value = data[5];
          if (data[6]) document.getElementById('remainingStow').value = data[6];
          if (data[7]) document.getElementById('sunriseVolume').value = data[7];
          if (data[8]) document.getElementById('samedayVolume').value = data[8];
          if (data[9]) document.getElementById('stowRatePPH').value = data[9];
          if (data[10]) document.getElementById('shiftStart').value = data[10];
          if (data[11]) document.getElementById('shiftEnd').value = data[11];
          if (data[12]) document.getElementById('sunriseInducted').value = data[12];
          if (data[13]) document.getElementById('sunriseStowed').value = data[13];
          if (data[14]) document.getElementById('samedayInducted').value = data[14];
          if (data[15]) document.getElementById('samedayStowed').value = data[15];
          if (data[16]) document.getElementById('clusterA').value = data[16];
          if (data[17]) document.getElementById('clusterB').value = data[17];
          if (data[18]) document.getElementById('clusterC').value = data[18];
          if (data[19]) document.getElementById('clusterD').value = data[19];
          if (data[20]) document.getElementById('clusterE').value = data[20];
          if (data[21]) document.getElementById('clusterG').value = data[21];
          if (data[22]) document.getElementById('targetFinishTime').value = data[22];
          if (data[23]) document.getElementById('efficiencyPercent').value = data[23];
          
          // Trigger calculations
          calculateRunTime();
          updateStats();
          updateProgress();
          calculateSameDay();
          updateHourlyDisplay();
          
          showSyncStatus('loaded');
        } else {
          showSyncStatus('empty');
        }
      } catch (error) {
        console.error('Cloud load error:', error);
        showSyncStatus('error');
      }
    }

    // Show sync status
    function showSyncStatus(status) {
      const indicator = document.getElementById('syncStatus');
      if (!indicator) return;
      
      switch(status) {
        case 'saved':
          indicator.innerHTML = ' Saved';
          indicator.style.color = '#3FB950';
          break;
        case 'loading':
          indicator.innerHTML = ' Loading...';
          indicator.style.color = '#FF9900';
          break;
        case 'loaded':
          indicator.innerHTML = ' Synced';
          indicator.style.color = '#3FB950';
          break;
        case 'error':
          indicator.innerHTML = ' Offline';
          indicator.style.color = '#F85149';
          break;
        case 'empty':
          indicator.innerHTML = ' No data';
          indicator.style.color = '#8B949E';
          break;
      }
      
      // Fade out after 3 seconds
      setTimeout(() => {
        indicator.innerHTML = '';
        indicator.style.color = '#8B949E';
      }, 3000);
    }

    // Debounce save to avoid too many requests
    let saveTimeout;
    function debouncedCloudSave() {
      clearTimeout(saveTimeout);
      saveTimeout = setTimeout(saveToCloud, 2000); // Save 2 seconds after last change
    }

    // ==================== DATA PERSISTENCE ====================
    const STORAGE_KEY = 'pphFlowStaffingData';

    // Save all form data to localStorage
    function saveAllData() {
      const data = {
        // Main volume
        totalVolume: document.getElementById('totalVolume').value,
        // Belt run time
        shiftStart: document.getElementById('shiftStart').value,
        shiftEnd: document.getElementById('shiftEnd').value,
        earlyEnd: document.getElementById('earlyEnd').value,
        break1: document.getElementById('break1').checked,
        lunch: document.getElementById('lunch').checked,
        break2: document.getElementById('break2').checked,
        customBreak: document.getElementById('customBreak').value,
        // Stow settings
        stowRatePPH: document.getElementById('stowRatePPH').value,
        efficiencyPercent: document.getElementById('efficiencyPercent').value,
        // Progress
        inductedSoFar: document.getElementById('inductedSoFar').value,
        stowedSoFar: document.getElementById('stowedSoFar').value,
        remainingInduct: document.getElementById('remainingInduct').value,
        remainingStow: document.getElementById('remainingStow').value,
        // Hourly update
        targetFinishTime: document.getElementById('targetFinishTime').value,
        // Clusters
        clusterA: document.getElementById('clusterA').value,
        clusterB: document.getElementById('clusterB').value,
        clusterC: document.getElementById('clusterC').value,
        clusterD: document.getElementById('clusterD').value,
        clusterE: document.getElementById('clusterE').value,
        clusterG: document.getElementById('clusterG').value,
        // Same Day
        sunriseVolume: document.getElementById('sunriseVolume').value,
        sunriseDeadline: document.getElementById('sunriseDeadline').value,
        sunriseInducted: document.getElementById('sunriseInducted').value,
        sunriseStowed: document.getElementById('sunriseStowed').value,
        samedayVolume: document.getElementById('samedayVolume').value,
        samedayStart: document.getElementById('samedayStart').value,
        samedayDeadline: document.getElementById('samedayDeadline').value,
        samedayInducted: document.getElementById('samedayInducted').value,
        samedayStowed: document.getElementById('samedayStowed').value,
        // WIP
        wipUnits: document.getElementById('wipUnits').value,
        wipStowRate: document.getElementById('wipStowRate').value,
        wipTargetMin: document.getElementById('wipTargetMin').value,
        wipTargetMax: document.getElementById('wipTargetMax').value,
        // Timestamp
        timestamp: new Date().toISOString()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    // Load all form data from localStorage
    function loadAllData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) return;
      
      try {
        const data = JSON.parse(saved);
        
        // Check if data is recent (within 24 hours)
        if (data.timestamp) {
          const savedTime = new Date(data.timestamp);
          const hoursDiff = (new Date() - savedTime) / (1000 * 60 * 60);
          if (hoursDiff > 24) return; // Data too old
        }
        
        // Restore all values
        if (data.totalVolume) document.getElementById('totalVolume').value = data.totalVolume;
        if (data.shiftStart) document.getElementById('shiftStart').value = data.shiftStart;
        if (data.shiftEnd) document.getElementById('shiftEnd').value = data.shiftEnd;
        if (data.earlyEnd) document.getElementById('earlyEnd').value = data.earlyEnd;
        if (data.break1 !== undefined) document.getElementById('break1').checked = data.break1;
        if (data.lunch !== undefined) document.getElementById('lunch').checked = data.lunch;
        if (data.break2 !== undefined) document.getElementById('break2').checked = data.break2;
        if (data.customBreak) document.getElementById('customBreak').value = data.customBreak;
        if (data.stowRatePPH) document.getElementById('stowRatePPH').value = data.stowRatePPH;
        if (data.efficiencyPercent) document.getElementById('efficiencyPercent').value = data.efficiencyPercent;
        if (data.inductedSoFar) document.getElementById('inductedSoFar').value = data.inductedSoFar;
        if (data.stowedSoFar) document.getElementById('stowedSoFar').value = data.stowedSoFar;
        if (data.remainingInduct) document.getElementById('remainingInduct').value = data.remainingInduct;
        if (data.remainingStow) document.getElementById('remainingStow').value = data.remainingStow;
        if (data.targetFinishTime) document.getElementById('targetFinishTime').value = data.targetFinishTime;
        if (data.clusterA) document.getElementById('clusterA').value = data.clusterA;
        if (data.clusterB) document.getElementById('clusterB').value = data.clusterB;
        if (data.clusterC) document.getElementById('clusterC').value = data.clusterC;
        if (data.clusterD) document.getElementById('clusterD').value = data.clusterD;
        if (data.clusterE) document.getElementById('clusterE').value = data.clusterE;
        if (data.clusterG) document.getElementById('clusterG').value = data.clusterG;
        if (data.sunriseVolume) document.getElementById('sunriseVolume').value = data.sunriseVolume;
        if (data.sunriseDeadline) document.getElementById('sunriseDeadline').value = data.sunriseDeadline;
        if (data.sunriseInducted) document.getElementById('sunriseInducted').value = data.sunriseInducted;
        if (data.sunriseStowed) document.getElementById('sunriseStowed').value = data.sunriseStowed;
        if (data.samedayVolume) document.getElementById('samedayVolume').value = data.samedayVolume;
        if (data.samedayStart) document.getElementById('samedayStart').value = data.samedayStart;
        if (data.samedayDeadline) document.getElementById('samedayDeadline').value = data.samedayDeadline;
        if (data.samedayInducted) document.getElementById('samedayInducted').value = data.samedayInducted;
        if (data.samedayStowed) document.getElementById('samedayStowed').value = data.samedayStowed;
        if (data.wipUnits) document.getElementById('wipUnits').value = data.wipUnits;
        if (data.wipStowRate) document.getElementById('wipStowRate').value = data.wipStowRate;
        if (data.wipTargetMin) document.getElementById('wipTargetMin').value = data.wipTargetMin;
        if (data.wipTargetMax) document.getElementById('wipTargetMax').value = data.wipTargetMax;
        
        // Trigger all calculations
        calculateRunTime();
        updateStats();
        updateProgress();
        calculateSameDay();
        updateSunriseProgress();
        updateSamedayProgress();
        calculateWIP();
        updateHourlyDisplay();
        
        console.log('Loaded saved PPH Flow data');
      } catch (e) {
        console.error('Error loading saved data:', e);
      }
    }

    // Reset all data
    function resetAllData() {
      if (!confirm('Are you sure you want to reset all data? This cannot be undone.')) {
        return;
      }
      
      // Clear localStorage
      localStorage.removeItem(STORAGE_KEY);
      localStorage.removeItem('flowStaffingData');
      
      // Reset all inputs to defaults
      document.getElementById('totalVolume').value = '';
      document.getElementById('shiftStart').value = '01:20';
      document.getElementById('shiftEnd').value = '08:30';
      document.getElementById('earlyEnd').value = '';
      document.getElementById('break1').checked = true;
      document.getElementById('lunch').checked = true;
      document.getElementById('break2').checked = true;
      document.getElementById('customBreak').value = '0';
      document.getElementById('stowRatePPH').value = '';
      document.getElementById('efficiencyPercent').value = '';
      document.getElementById('inductedSoFar').value = '';
      document.getElementById('stowedSoFar').value = '';
      document.getElementById('remainingInduct').value = '';
      document.getElementById('remainingStow').value = '';
      document.getElementById('targetFinishTime').value = '08:00';
      document.getElementById('clusterA').value = '';
      document.getElementById('clusterB').value = '';
      document.getElementById('clusterC').value = '';
      document.getElementById('clusterD').value = '';
      document.getElementById('clusterE').value = '';
      document.getElementById('clusterG').value = '';
      document.getElementById('sunriseVolume').value = '';
      document.getElementById('sunriseDeadline').value = '03:30';
      document.getElementById('sunriseInducted').value = '';
      document.getElementById('sunriseStowed').value = '';
      document.getElementById('samedayVolume').value = '';
      document.getElementById('samedayStart').value = '03:00';
      document.getElementById('samedayDeadline').value = '03:30';
      document.getElementById('samedayInducted').value = '';
      document.getElementById('samedayStowed').value = '';
      document.getElementById('wipUnits').value = '';
      document.getElementById('wipStowRate').value = '';
      document.getElementById('wipTargetMin').value = '10';
      document.getElementById('wipTargetMax').value = '20';
      
      // Clear all actual HC inputs
      document.querySelectorAll('.actual-input').forEach(input => input.value = '');
      
      // Trigger all calculations
      calculateRunTime();
      updateStats();
      updateProgress();
      calculateSameDay();
      calculateWIP();
      updateHourlyDisplay();
      
      // Show confirmation
      alert('All data has been reset.');
    }

    // Auto-save on any input change
    document.addEventListener('input', function(e) {
      if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
        saveAllData();
        debouncedCloudSave(); // Also save to cloud
      }
    });

    // Load saved data on page load
    loadAllData();
    
    // Try to load from cloud
    loadFromCloud();
  </script>
</body>
</html>
